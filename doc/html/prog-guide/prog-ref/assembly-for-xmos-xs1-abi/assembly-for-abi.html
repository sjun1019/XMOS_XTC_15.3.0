<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Assembly programming manual" href="../assembly-manual/assembly.html" /><link rel="prev" title="Inline assembly" href="../inline-assembly/inline-assembly.html" />

    <link rel="shortcut icon" href="../../../_static/x-favicon.png"/><!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>Make assembly programs compatible with the XMOS XS1 ABI - XMOS XTC Tools v15.3</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #1399DB;
  --color-brand-content: #1399DB;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #1399DB;
  --color-brand-content: #1399DB;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #1399DB;
  --color-brand-content: #1399DB;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">XMOS XTC Tools v15.3</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/x-logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">XMOS XTC Tools v15.3</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><!-- This html element presents a list of pdfs that can be generated -->
<!-- We expect pdfs to be in a folder called pdf alongside the folder called html -->

<!-- TODO: generate this list using JS only for real pdfs that exist -->

<!-- pathto(root_doc) set by sphinx for each page, but root doc has # -->

<div id="pdf_linker">
    <script>
        function openPDF(url) {
            if (url=="--select--") {
                return;
            }
            window.location.href = url;
        }
    </script>
    PDFs:
    <select title="Link to generated pdfs" onchange="openPDF(value);">
        <option>--select--</option>
        
        <option
            title="xtc_tools_introduction_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_tools_introduction_v15.3.pdf"
        >
            XMOS XTC Tools - Introduction
        </option> 
        
        <option
            title="xtc_tools_installation_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_tools_installation_v15.3.pdf"
        >
            XMOS XTC Tools - Installation
        </option> 
        
        <option
            title="xtc_tools_guide_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_tools_guide_v15.3.pdf"
        >
            XMOS XTC Tools - Tools Guide
        </option> 
        
        <option
            title="xtc_prog_guide_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_prog_guide_v15.3.pdf"
        >
            XMOS XTC Tools - Programming Guide
        </option> 
        
    </select>
</div>
<div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../intro/index.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../installation/index.html">Installation guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/system-requirements/requirements.html">System requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/install-tools/install.html">Installation instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/install-tools/install_prerequisites.html">Installation of required third-party tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/getting-started.html">Configuring the command-line environment</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../tools-guide/index.html">Tools guide</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../tools-guide/quick-start/index.html">Quick start</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/quick-start/single-tile.html">A single-tile program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/quick-start/multi-tile.html">Targeting multiple tiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/quick-start/switch-setup.html">Communicating between tiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/quick-start/fast-printf.html">Using xSCOPE for fast “printf debugging”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/quick-start/debug.html">Debugging with XGDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/quick-start/build-system.html">Build system</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../tools-guide/vscode-guide/index.html">Using VS Code</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/vscode-guide/example/index.html">Building an example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/vscode-guide/next-steps/index.html">Using VS Code with a real project</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../tools-guide/tutorials/index.html">Tools and target features</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tutorials/describe-a-target-platform/platform.html">Describe a target platform</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/index.html">Working with targets</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html#key-target-based-features">Key target-based features</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html#xtag">xTAG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html#host-tools">Host tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html#target-interaction">Target interaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html#host-io">Host-IO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html#xscope-apis">xSCOPE APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html#user-supplied-host-program">User-supplied host program</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html#sample-based-profiling-of-the-target-program">Sample-based profiling of the target program</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html#target-errors-and-warnings">Target errors and warnings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tutorials/working-with-targets/intro.html#command-examples">Command examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tutorials/design-with-flash/flash.html">Design and manufacture systems with flash memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tutorials/safeguard-ip/safeguard.html">Safeguard IP and device authenticity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tutorials/add-flash-support/flash.html">Add support for a new flash device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tutorials/lpddr.html">Using LPDDR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tutorials/swmem.html">Using software-defined memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tutorials/args-and-ret-codes.html">How to use arguments and return codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tutorials/using-xsim.html">Using XSIM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tutorials/understanding-xe-structure.html">Understanding XE files and how they are loaded</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../tools-guide/tools-ref/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../tools-guide/tools-ref/cmd-line-tools/index.html">Command line tools</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/cmd-line-tools/xrun-manual/xrun-manual.html">XRUN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/cmd-line-tools/xsim-manual/xsim-manual.html">XSIM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/cmd-line-tools/xcc-manual/xcc-manual.html">XCC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/cmd-line-tools/xobjdump-manual/xobjdump-manual.html">XOBJDUMP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/cmd-line-tools/xgdb-manual/xgdb-manual.html">XGDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/cmd-line-tools/xgdbserver-manual/xgdbserver-manual.html">XGDBSERVER</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/cmd-line-tools/xflash-manual/xflash-manual.html">XFLASH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/cmd-line-tools/xburn-manual/xburn-manual.html">XBURN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/cmd-line-tools/xmake-manual/xmake-manual.html">XMAKE</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../tools-guide/tools-ref/formats/index.html">File formats and data descriptions</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/formats/xe.html">XMOS executable (XE) file format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/formats/xn-spec/xn-spec.html">XN specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/formats/xsim-trace.html">XSIM trace output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/formats/config-xscope.html">xSCOPE config file</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../tools-guide/tools-ref/xscope/index.html">xSCOPE</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/xscope/xscope-command-line-options.html">xSCOPE command line options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/xscope/xscope-performance.html">xSCOPE performance figures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/xscope/xscope-target-library.html">xSCOPE target library</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/xscope/xscope-host-library.html">xSCOPE host library</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../tools-guide/tools-ref/libraries/index.html">Libraries</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/libraries/lib-xcore-api/lib-xcore-api.html">lib_xcore</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../tools-guide/tools-ref/libraries/libxs1/lib-xs1-api.html">lib_xs1</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../tools-guide/tools-ref/libraries/libxs1/lib-xs1-defines-xs3a.html">XS3 definitions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../tools-guide/tools-ref/libraries/libxs1/lib-xs1-defines-xs2a.html">XS2 definitions</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/libraries/libflash-api/libflash-api.html">libflash API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/libraries/libquadflash-api/libquadflash-api.html">libquadflash API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/libraries/libflash-included-devices/libflash-devices.html">List of devices natively supported by libflash</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/libraries/libquadflash-included-devices/libquadflash-devices.html">List of devices natively supported by libquadflash</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/libraries/lib-otp-api/lib-otp-api.html">lib_otp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tools-ref/xcommon_cmake.html">XCommon CMake build system</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../tools-guide/tools-ref/xcommon/index.html">XCOMMON build system</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/xcommon/using-makefiles.html">Using the XCOMMON build system</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../tools-guide/tools-ref/xcommon/makefile-libraries.html">Using XMOS Makefiles to create binary libraries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools-guide/tools-ref/transitioning/index.html">Transitioning from older tools releases</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Programming guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../arch-hw-guide/index.html">Architecture &amp; hardware guide</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../quick-start/index.html">Quick start</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/prog-model.html">The multicore programming model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/c-programming-guide/index.html">Programming an XCORE tile with C and lib_xcore</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index.html">Reference</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3 has-children"><a class="reference internal" href="../programming-in-c-xc.html">Programming in C/XC</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../calling-between-c-xc/calling.html">Calling between C/C++ and XC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../xc-imp-defined-behavior/xc-imp.html">XC implementation-defined behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../c-imp-defined-behavior/c-imp.html">C implementation-defined behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../c-lang-ref/clangref.html">C and C++ language reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../xcc-pragma-directives/pragmas.html">XCC pragma directives</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cheat.html">XC to C cheat sheet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../memory-models.html">Memory models</a></li>
</ul>
</li>
<li class="toctree-l3 current has-children"><a class="reference internal" href="../programming-in-asm.html">Programming in assembly</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../inline-assembly/inline-assembly.html">Inline assembly</a></li>
<li class="toctree-l4 current current-page"><a class="current reference internal" href="#">Make assembly programs compatible with the XMOS XS1 ABI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../assembly-manual/assembly.html">Assembly programming manual</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../programming-xs1-devices.html">Programming for XCORE Devices</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../xs1-data-types/datatypes.html">xcore data types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../xs1-port-to-pin-map/portmap.html">xcore port-to-pin mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../xs1-abi/abi.html">XCORE 32-bit application binary interface</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="make-assembly-programs-compatible-with-the-xmos-xs1-abi">
<span id="asm-for-xs1-abi"></span><h1>Make assembly programs compatible with the XMOS XS1 ABI<a class="headerlink" href="#make-assembly-programs-compatible-with-the-xmos-xs1-abi" title="Permalink to this heading">#</a></h1>
<p>The XMOS XS1 Application Binary Interface (ABI) defines the linking interface for objects compiled
from C/C++, XC and assembly code. This tutorial explains how to write functions in assembly
code that can be linked against objects generated by the XMOS compiler.</p>
<section id="symbols">
<span id="asm-for-xs1-abi-symbols"></span><h2>Symbols<a class="headerlink" href="#symbols" title="Permalink to this heading">#</a></h2>
<p>As the assembler parses an assembly file, it maintains a current address which it increments every
time it allocates storage.</p>
<p>Symbols are used to associate names to addresses. Symbols may be referenced in directives and
instructions, and the linker patches the corresponding address onces its value is calculated.</p>
<p>The program below defines a symbol with name <code class="docutils literal notranslate"><span class="pre">f</span></code> that refers to the value of the current address.
It also makes the symbol globally visible from other files, which can reference the symbol by its
name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Give the symbol f the value of the current address.</span>
<span class="n">f</span><span class="p">:</span>
<span class="c1"># Mark the symbol f as global.</span>
  <span class="o">.</span><span class="n">globl</span> <span class="n">f</span>
</pre></div>
</div>
<p>The symbol is defined by writing its name followed by a colon. The <code class="docutils literal notranslate"><span class="pre">.globl</span></code> directive makes the
symbol visible from outside of the file.</p>
</section>
<section id="alignment">
<span id="asm-for-xs1-abi-alignment"></span><h2>Alignment<a class="headerlink" href="#alignment" title="Permalink to this heading">#</a></h2>
<p>The XS1 ABI specifies minimum alignment requirements for code and data. The start of a
function must be 2-byte aligned, and data must be word-aligned. An address is aligned by placing
the <code class="docutils literal notranslate"><span class="pre">.align</span></code> directive before the definition of a symbol.</p>
<p>The program below defines a symbol <code class="docutils literal notranslate"><span class="pre">f</span></code> that is defined to be the next 2-byte aligned address.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Force 2 byte alignment of the next address.</span>
  <span class="o">.</span><span class="n">align</span> <span class="mi">2</span>
<span class="n">f</span><span class="p">:</span>
</pre></div>
</div>
</section>
<section id="sections">
<span id="asm-for-xs1-abi-sections"></span><h2>Sections<a class="headerlink" href="#sections" title="Permalink to this heading">#</a></h2>
<p>Each object file may contain multiple sections. When combined by the linker, sections with the
same name in each object file are placed together at consecutive addresses. This allows different
types of code or data to be grouped together in the final executable.</p>
<p>The XS1 ABI requires functions to be placed in the <code class="docutils literal notranslate"><span class="pre">.text</span></code> section, read-only data in the <code class="docutils literal notranslate"><span class="pre">.cp.rodata</span></code>
section and writable data in the <code class="docutils literal notranslate"><span class="pre">.dp.data</span></code> section. The default section is the <code class="docutils literal notranslate"><span class="pre">.text</span></code> section, and
the current section can be changed using one of the following directives.</p>
<div class="table-wrapper docutils container" id="id1">
<span id="asm-for-xs1-abi-sections-table"></span><span id="asm-for-xs1-abi-sections-table"></span><table class="docutils align-default" id="id1">
<caption><span class="caption-number">Table 48 </span><span class="caption-text">Sections supported by the XMOS linker</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Section</p></th>
<th class="head"><p>Used For</p></th>
<th class="head"><p>Directive</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.text</span></code></p></td>
<td><p>Executable code</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.text</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.dp.data</span></code></p></td>
<td><p>Writable data</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.section</span> <span class="pre">.dp.data,</span> <span class="pre">&quot;awd&quot;,</span> <span class="pre">&#64;progbits</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.cp.data</span></code></p></td>
<td><p>Read only data</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.section</span> <span class="pre">.cp.rodata,</span> <span class="pre">&quot;ac&quot;,</span> <span class="pre">&#64;progbits</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<section id="data">
<span id="asm-for-xs1-abi-data"></span><h3>Data<a class="headerlink" href="#data" title="Permalink to this heading">#</a></h3>
<p>The example program below defines a 4-byte writeable object, initialized with the value 5, and
aligned on a 4-byte boundary.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">.</span><span class="n">section</span> <span class="o">.</span><span class="n">dp</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;awd&quot;</span><span class="p">,</span> <span class="nd">@progbits</span>
  <span class="o">.</span><span class="n">align</span> <span class="mi">4</span>
<span class="n">x</span><span class="p">:</span>
  <span class="o">.</span><span class="n">word</span> <span class="mi">5</span>
</pre></div>
</div>
<p>You can use the following directives to emit different types of data.</p>
<div class="table-wrapper docutils container" id="id2">
<span id="asm-for-xs1-abi-data-directives-table"></span><span id="asm-for-xs1-abi-data-directives-table"></span><table class="docutils align-default" id="id2">
<caption><span class="caption-number">Table 49 </span><span class="caption-text">Directives for emitting different types of data</span><a class="headerlink" href="#id2" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Directive</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.byte</span></code></p></td>
<td><p>Emits a 1 byte value</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.short</span></code></p></td>
<td><p>Emits a 2 byte value</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.word</span></code></p></td>
<td><p>Emits a 4 byte value</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.space</span></code></p></td>
<td><p>Emits an <em>n</em>-byte array of zero-initialized storage, where <em>n</em> is the argument to the directive</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">.asciiz</span></code></p></td>
<td><p>Emits a null terminated ASCII string</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">.ascii</span></code></p></td>
<td><p>Emits an ASCII string (no implicit terminating character)</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="arrays">
<span id="asm-for-xs1-abi-arrays"></span><h3>Arrays<a class="headerlink" href="#arrays" title="Permalink to this heading">#</a></h3>
<p>The program below defines a global array that is 42 bytes in size.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">.</span><span class="n">section</span> <span class="o">.</span><span class="n">dp</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;awd&quot;</span><span class="p">,</span> <span class="nd">@progbits</span>
  <span class="o">.</span><span class="n">globl</span> <span class="n">a</span>
  <span class="o">.</span><span class="n">align</span> <span class="mi">4</span>
<span class="n">a</span><span class="p">:</span>
  <span class="o">.</span><span class="n">space</span> <span class="mi">42</span>
  <span class="o">.</span><span class="n">globl</span> <span class="n">a</span><span class="o">.</span><span class="n">globound</span>
  <span class="o">.</span><span class="n">set</span> <span class="n">a</span><span class="o">.</span><span class="n">globound</span><span class="p">,</span> <span class="mi">42</span>
</pre></div>
</div>
<p>The XS1 ABI requires that for each global array <code class="docutils literal notranslate"><span class="pre">f</span></code> there is a corresponding global symbol
<code class="docutils literal notranslate"><span class="pre">f.globound</span></code> which is initialized with the number of elements of the first dimension of the array.
You can use the <code class="docutils literal notranslate"><span class="pre">.set</span></code> directive to perform the initialization. Note that this value is used for array
bounds checking if the variable is used by an XC function.</p>
</section>
</section>
<section id="functions">
<span id="asm-for-xs1-functions"></span><h2>Functions<a class="headerlink" href="#functions" title="Permalink to this heading">#</a></h2>
<p>The XS1 ABI specifies rules for passing parameters and return values between functions. It also
defines symbols for specifying the amount of hardware resources required by the function.</p>
<section id="parameters-and-return-values">
<span id="asm-for-xs1-abi-params-and-return-values"></span><h3>Parameters and return values<a class="headerlink" href="#parameters-and-return-values" title="Permalink to this heading">#</a></h3>
<p>Scalar values of up to 32 bits are passed as 32 bit values. The first four parameters are passed in
registers <em>r0</em>, <em>r1</em>, <em>r2</em> and <em>r3</em>, and any additional parameters are passed on the stack. Similarly, the
first four return values are returned in the registers <em>r0</em>, <em>r1</em>, <em>r2</em> and <em>r3</em>, and any additional values
are returned on the stack.</p>
<p>In the XC function prototype below, the parameters a and b are passed in registers <em>r0</em> and <em>r1</em>, as
are the return values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">}</span> <span class="n">swap</span><span class="p">(</span><span class="nb">int</span> <span class="n">a</span><span class="p">,</span> <span class="nb">int</span> <span class="n">b</span><span class="p">);</span>
</pre></div>
</div>
<p>An assembly implementation of this function is shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">.</span><span class="n">globl</span> <span class="n">swap</span>
  <span class="o">.</span><span class="n">align</span> <span class="mi">2</span>
<span class="n">swap</span><span class="p">:</span>
  <span class="n">mov</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r0</span>
  <span class="n">mov</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r1</span>
  <span class="n">mov</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span>
  <span class="n">retsp</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="caller-and-callee-save-registers">
<span id="asm-for-xs1-abi-registers"></span><h3>Caller and callee save registers<a class="headerlink" href="#caller-and-callee-save-registers" title="Permalink to this heading">#</a></h3>
<p>The XS1 ABI specifices that the registers <em>r0</em>, <em>r1</em>, <em>r2</em>, <em>r3</em> and <em>r11</em> are <em>caller-save</em>, and all other
registers are <em>callee-save</em>.</p>
<p>Before a function is called, the contents of all caller-save registers whose values are required after
the call must be saved. Upon returning from a function, the contents of all callee-save registers
must be the same as on entry to the function.</p>
<p>The following example shows the prologue and epilogue for a function that uses the callee-save
registers <em>r4</em>, <em>r5</em> and <em>r6</em>. The prologue copies the register values to the stack, and the epilogue
restores the values from the stack back to the registers.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prologue</span>
  <span class="n">entsp</span> <span class="mi">4</span>
  <span class="n">stw</span> <span class="n">r4</span><span class="p">,</span> <span class="n">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">stw</span> <span class="n">r5</span><span class="p">,</span> <span class="n">sp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">stw</span> <span class="n">r6</span><span class="p">,</span> <span class="n">sp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

<span class="c1"># Main body of function goes here</span>
<span class="c1"># ...</span>

<span class="c1"># Epilogue</span>
  <span class="n">ldw</span> <span class="n">r4</span><span class="p">,</span> <span class="n">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">ldw</span> <span class="n">r5</span><span class="p">,</span> <span class="n">sp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">ldw</span> <span class="n">r6</span><span class="p">,</span> <span class="n">sp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
  <span class="n">retsp</span> <span class="mi">4</span>
</pre></div>
</div>
</section>
<section id="resource-usage">
<span id="asm-for-xs1-abi-resource-usage"></span><h3>Resource usage<a class="headerlink" href="#resource-usage" title="Permalink to this heading">#</a></h3>
<p>The linker attempts to calculate the amount of resources required by each function, including its
memory requirements, and the number of threads, channel ends and timers it uses. This allows
the linker to check that the resource usage of the final executable does not exceed that available
on the target device.</p>
<p>For a function <code class="docutils literal notranslate"><span class="pre">f</span></code>, the resource usage symbols defined by the XS1 ABI are as follows.</p>
<div class="table-wrapper docutils container" id="id3">
<span id="asm-for-xs1-abi-resource-usage-table"></span><span id="asm-for-xs1-abi-resource-usage-table"></span><table class="docutils align-default" id="id3">
<caption><span class="caption-number">Table 50 </span><span class="caption-text">Resource usage symbols defined by the XS1 ABI</span><a class="headerlink" href="#id3" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">f.nstackwords</span></code></p></td>
<td><p>Stack size (in words)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">f.maxthreads</span></code></p></td>
<td><p>Maximum number of threads allocated, including the current thread</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">f.maxchanends</span></code></p></td>
<td><p>Maximum number of channel ends allocated</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">f.maxtimers</span></code></p></td>
<td><p>Maximum number of timer allocated</p></td>
</tr>
</tbody>
</table>
</div>
<p>You can define resource usage symbols using the <code class="docutils literal notranslate"><span class="pre">.linkset</span></code> directive. If a function is global, you
should also make the resource usage symbols global.</p>
<p>The example program below defines resource usage symbols for a function <code class="docutils literal notranslate"><span class="pre">f</span></code> that uses 4 words of
stack, 2 threads, 0 timers and 2 channel ends.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">globl</span> <span class="n">f</span>
<span class="o">.</span><span class="n">globl</span> <span class="n">f</span><span class="o">.</span><span class="n">nstackwords</span>
<span class="o">.</span><span class="n">linkset</span> <span class="n">f</span><span class="o">.</span><span class="n">nstackwords</span><span class="p">,</span> <span class="mi">5</span>
<span class="o">.</span><span class="n">globl</span> <span class="n">f</span><span class="o">.</span><span class="n">maxthreads</span>
<span class="o">.</span><span class="n">linkset</span> <span class="n">f</span><span class="o">.</span><span class="n">maxthreads</span><span class="p">,</span> <span class="mi">2</span>
<span class="o">.</span><span class="n">globl</span> <span class="n">f</span><span class="o">.</span><span class="n">maxtimers</span>
<span class="o">.</span><span class="n">linkset</span> <span class="n">f</span><span class="o">.</span><span class="n">maxtimers</span><span class="p">,</span> <span class="mi">0</span>
<span class="o">.</span><span class="n">globl</span> <span class="n">f</span><span class="o">.</span><span class="n">maxchanends</span>
<span class="o">.</span><span class="n">linkset</span> <span class="n">f</span><span class="o">.</span><span class="n">maxchanends</span><span class="p">,</span> <span class="mi">2</span>
</pre></div>
</div>
<p>In more complex cases, you can use the maximum (<code class="docutils literal notranslate"><span class="pre">$M</span></code>) and addition (<code class="docutils literal notranslate"><span class="pre">+</span></code>) operators to build
expressions for the resource usage that are evaluated by the linker. If two functions are called in
sequence, you should compute the maximum for the two functions, and if called in parallel you
should compute the sum for the two functions.</p>
<p>The example program below defines resource usage symbols for a function <code class="docutils literal notranslate"><span class="pre">f</span></code> that extends the
stack by 10 words, allocates two timers and calls functions <code class="docutils literal notranslate"><span class="pre">g</span></code> and <code class="docutils literal notranslate"><span class="pre">h</span></code> in sequence before freeing the
timer and returning.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.globl f
.globl f.nstackwords
.linkset f.nstackwords, 10 + (g.nstackwords $M h.nstackwords)
.globl f.maxthreads
.linkset f.maxthreads, 1 + ((g.maxthreads-1) $M (h.maxthreads-1))
.globl f.maxtimers
.linkset f.maxtimers, 2 + (g.maxtimers $M h.maxtimers)
.globl f.maxchanends
.linkset f.maxchanends, 0 + (g. maxchanends $M h.maxchanends)
</pre></div>
</div>
<p>You can omit the definition of a resource usage symbol if its value is unknown, for example if the
function makes an indirect call through a function pointer. If the value of the symbol is required
to satisfy a relocation in the program, however, the program will fail to link.</p>
</section>
<section id="side-effects">
<span id="asm-for-xs1-abi-side-effects"></span><h3>Side effects<a class="headerlink" href="#side-effects" title="Permalink to this heading">#</a></h3>
<p>The XC language requires that functions used as boolean guards in <code class="docutils literal notranslate"><span class="pre">select</span></code> statements have no
side effects. It also specifies that functions called from within a transaction statement do not
declare channels. By default, a function <code class="docutils literal notranslate"><span class="pre">f</span></code> is assumed to be side-effecting and to declare channels
unless you explicitly set the following symbols to zero.</p>
<div class="table-wrapper docutils container" id="id4">
<span id="asm-for-xs1-abi-side-effects-table"></span><span id="asm-for-xs1-abi-side-effects-table"></span><table class="docutils align-default" id="id4">
<caption><span class="caption-number">Table 51 </span><span class="caption-text">Symbols for denoting side-effects</span><a class="headerlink" href="#id4" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">f.locnoside</span></code></p></td>
<td><p>Specifies whether the function is side effecting</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">f.locnochandec</span></code></p></td>
<td><p>Specifies whether the function allocates a channel end</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="elimination-blocks">
<span id="asm-for-xs1-abi-elimination-blocks"></span><h2>Elimination blocks<a class="headerlink" href="#elimination-blocks" title="Permalink to this heading">#</a></h2>
<p>The linker can eliminate unused code and data. Code and data must be placed in elimination
blocks for it to be a candidate for elimination. At final link time, if all of the symbols inside an
elimination block are unreferenced, the block is removed from the final image.</p>
<p>The example program below declares a symbol within an elimination block.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">.</span><span class="n">cc_top</span> <span class="n">f</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="n">f</span>
<span class="n">f</span><span class="p">:</span>
  <span class="o">.</span><span class="n">cc_bottom</span> <span class="n">f</span><span class="o">.</span><span class="n">function</span>
</pre></div>
</div>
<p>The first argument to the <code class="docutils literal notranslate"><span class="pre">.cc_top</span></code> directive and the <code class="docutils literal notranslate"><span class="pre">.cc_bottom</span></code> directive is the name of the
elimination block. The <code class="docutils literal notranslate"><span class="pre">.cc_top</span></code> directive takes an additional argument, which is a symbol on
which the elimination of the block is predicated on. If the symbol is referenced, the block is not
eliminated.</p>
<p>Each elimination block must be given a name which is unique within the assembly file.</p>
</section>
<section id="typestrings">
<span id="asm-for-xs1-abi-typestrings"></span><h2>Typestrings<a class="headerlink" href="#typestrings" title="Permalink to this heading">#</a></h2>
<p>A typestring is a string used to describe the type of a function or variable. The encoding of type
information into a typestring is specified by the XS1 ABI. The following directives are used to associate
a typestring with a symbol.</p>
<div class="table-wrapper docutils container" id="id5">
<span id="asm-for-xs1-abi-typestrings-table"></span><span id="asm-for-xs1-abi-typestrings-table"></span><table class="docutils align-default" id="id5">
<caption><span class="caption-number">Table 52 </span><span class="caption-text">Typestring directives</span><a class="headerlink" href="#id5" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Binding</p></th>
<th class="head"><p>Directive</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Global</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.globl</span> <span class="pre">name,</span> <span class="pre">&quot;typestring&quot;</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>External</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.extern</span> <span class="pre">name,</span> <span class="pre">&quot;typestring&quot;</span></code></p></td>
</tr>
<tr class="row-even"><td><p>Local</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">.locl</span> <span class="pre">name,</span> <span class="pre">&quot;typestring&quot;</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p>When a symbol from one object file is matched with a symbol with the same name in another
object, the linker checks whether the typestrings are compatible. If the typestrings are compatible
linking continues as normal. If the typestrings are function types which differ only in the presence
of array bound parameters the linker generates a thunk and replaces uses of the symbol with
this thunk to account for the difference in arguments. The linker errors on all other typestring
mismatches. This ensures that programs that are compiled from multiple files are as robust as
those compiled from a single file.</p>
<p>If you fail to emit a typestring for a symbol, comparisons against this symbol are assumed to be
compatible. If you are implementing a function which takes an array of unknown size, you should
emit a typestring to allow it to be called from both C and XC. In other cases, typestrings can be
omitted, but error checking is not performed.</p>
</section>
<section id="example">
<span id="asm-for-xs1-abi-example"></span><h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">#</a></h2>
<p>The program below prints the words “Hello world” to standard output.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">const</span> <span class="n">char</span> <span class="nb">str</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;Hello world&quot;</span><span class="p">;</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="nb">str</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The assembly implementation below complies with the XS1 ABI.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">.</span><span class="n">extern</span> <span class="n">printf</span><span class="p">,</span> <span class="s2">&quot;f</span><span class="si">{si}</span><span class="s2">(p(c:uc),va)&quot;</span>
  <span class="o">.</span><span class="n">section</span> <span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">rodata</span><span class="p">,</span> <span class="s2">&quot;ac&quot;</span><span class="p">,</span> <span class="nd">@progbits</span>
  <span class="o">.</span><span class="n">globl</span> <span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;a(12:c:uc)&quot;</span>
  <span class="o">.</span><span class="n">cc_top</span> <span class="nb">str</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span>
  <span class="o">.</span><span class="n">align</span> <span class="mi">4</span>
<span class="nb">str</span> <span class="p">:</span>
  <span class="o">.</span><span class="n">asciiz</span> <span class="s2">&quot;Hello world&quot;</span>
<span class="o">.</span><span class="n">cc_bottom</span> <span class="nb">str</span><span class="o">.</span><span class="n">data</span>
  <span class="o">.</span><span class="n">globl</span> <span class="nb">str</span><span class="o">.</span><span class="n">globound</span>
  <span class="o">.</span><span class="n">set</span> <span class="nb">str</span><span class="o">.</span><span class="n">globound</span><span class="p">,</span> <span class="mi">12</span>

  <span class="o">.</span><span class="n">text</span>
  <span class="o">.</span><span class="n">globl</span> <span class="n">main</span><span class="p">,</span> <span class="s2">&quot;f</span><span class="si">{si}</span><span class="s2">(0)&quot;</span>
<span class="o">.</span><span class="n">cc_top</span> <span class="n">main</span><span class="o">.</span><span class="n">function</span><span class="p">,</span> <span class="n">main</span>
  <span class="o">.</span><span class="n">align</span> <span class="mi">2</span>
<span class="n">main</span><span class="p">:</span>
  <span class="n">entsp</span> <span class="mi">1</span>
  <span class="n">ldaw</span> <span class="n">r11</span><span class="p">,</span> <span class="n">cp</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
  <span class="n">mov</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r11</span>
  <span class="n">bl</span> <span class="n">printf</span>
  <span class="n">ldc</span> <span class="n">r0</span><span class="p">,</span> <span class="mi">0</span>
  <span class="n">retsp</span> <span class="mi">0</span>
<span class="o">.</span><span class="n">cc_bottom</span> <span class="n">main</span><span class="o">.</span><span class="n">function</span>
  <span class="o">.</span><span class="n">globl</span> <span class="n">main</span><span class="o">.</span><span class="n">nstackwords</span>
  <span class="o">.</span><span class="n">linkset</span> <span class="n">main</span> <span class="o">.</span><span class="n">nstackwords</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">printf</span><span class="o">.</span><span class="n">nstackwords</span>
  <span class="o">.</span><span class="n">globl</span> <span class="n">main</span><span class="o">.</span><span class="n">maxthreads</span>
  <span class="o">.</span><span class="n">linkset</span> <span class="n">main</span><span class="o">.</span><span class="n">maxthreads</span><span class="p">,</span> <span class="n">printf</span><span class="o">.</span><span class="n">maxthreads</span>
  <span class="o">.</span><span class="n">globl</span> <span class="n">main</span><span class="o">.</span><span class="n">maxtimers</span>
  <span class="o">.</span><span class="n">linkset</span> <span class="n">main</span><span class="o">.</span><span class="n">maxtimers</span><span class="p">,</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">printf</span><span class="o">.</span><span class="n">maxtimers</span>
  <span class="o">.</span><span class="n">globl</span> <span class="n">main</span><span class="o">.</span><span class="n">maxchanends</span>
  <span class="o">.</span><span class="n">linkset</span> <span class="n">main</span><span class="o">.</span><span class="n">maxchanends</span><span class="p">,</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">printf</span><span class="o">.</span><span class="n">maxchanends</span>
  <span class="o">.</span><span class="n">linkset</span> <span class="n">main</span><span class="o">.</span><span class="n">locnochandec</span><span class="p">,</span> <span class="mi">1</span>
  <span class="o">.</span><span class="n">linkset</span> <span class="n">main</span><span class="o">.</span><span class="n">locnoside</span><span class="p">,</span> <span class="mi">1</span>
</pre></div>
</div>
<p>By defining symbols for resource usage, the linker can check whether the program fits on a target
device. By providing typestrings, the linker can check type compatibilty when different object files
are linked. The linker can eliminate unused code and data since it is placed in elimination blocks.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../assembly-manual/assembly.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Assembly programming manual</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../inline-assembly/inline-assembly.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Inline assembly</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, XMOS Ltd
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Jul 24, 2024</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Make assembly programs compatible with the XMOS XS1 ABI</a><ul>
<li><a class="reference internal" href="#symbols">Symbols</a></li>
<li><a class="reference internal" href="#alignment">Alignment</a></li>
<li><a class="reference internal" href="#sections">Sections</a><ul>
<li><a class="reference internal" href="#data">Data</a></li>
<li><a class="reference internal" href="#arrays">Arrays</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functions">Functions</a><ul>
<li><a class="reference internal" href="#parameters-and-return-values">Parameters and return values</a></li>
<li><a class="reference internal" href="#caller-and-callee-save-registers">Caller and callee save registers</a></li>
<li><a class="reference internal" href="#resource-usage">Resource usage</a></li>
<li><a class="reference internal" href="#side-effects">Side effects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#elimination-blocks">Elimination blocks</a></li>
<li><a class="reference internal" href="#typestrings">Typestrings</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    </body>
</html>