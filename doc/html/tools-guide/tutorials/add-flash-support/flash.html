<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Using LPDDR" href="../lpddr.html" /><link rel="prev" title="Safeguard IP and device authenticity" href="../safeguard-ip/safeguard.html" />

    <link rel="shortcut icon" href="../../../_static/x-favicon.png"/><!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>Add support for a new flash device - XMOS XTC Tools v15.3</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #1399DB;
  --color-brand-content: #1399DB;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #1399DB;
  --color-brand-content: #1399DB;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #1399DB;
  --color-brand-content: #1399DB;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">XMOS XTC Tools v15.3</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/x-logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">XMOS XTC Tools v15.3</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><!-- This html element presents a list of pdfs that can be generated -->
<!-- We expect pdfs to be in a folder called pdf alongside the folder called html -->

<!-- TODO: generate this list using JS only for real pdfs that exist -->

<!-- pathto(root_doc) set by sphinx for each page, but root doc has # -->

<div id="pdf_linker">
    <script>
        function openPDF(url) {
            if (url=="--select--") {
                return;
            }
            window.location.href = url;
        }
    </script>
    PDFs:
    <select title="Link to generated pdfs" onchange="openPDF(value);">
        <option>--select--</option>
        
        <option
            title="xtc_tools_introduction_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_tools_introduction_v15.3.pdf"
        >
            XMOS XTC Tools - Introduction
        </option> 
        
        <option
            title="xtc_tools_installation_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_tools_installation_v15.3.pdf"
        >
            XMOS XTC Tools - Installation
        </option> 
        
        <option
            title="xtc_tools_guide_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_tools_guide_v15.3.pdf"
        >
            XMOS XTC Tools - Tools Guide
        </option> 
        
        <option
            title="xtc_prog_guide_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_prog_guide_v15.3.pdf"
        >
            XMOS XTC Tools - Programming Guide
        </option> 
        
    </select>
</div>
<div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../intro/index.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../installation/index.html">Installation guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/system-requirements/requirements.html">System requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/install-tools/install.html">Installation instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/install-tools/install_prerequisites.html">Installation of required third-party tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/getting-started.html">Configuring the command-line environment</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Tools guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../../quick-start/index.html">Quick start</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/single-tile.html">A single-tile program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/multi-tile.html">Targeting multiple tiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/switch-setup.html">Communicating between tiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/fast-printf.html">Using xSCOPE for fast “printf debugging”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/debug.html">Debugging with XGDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/build-system.html">Build system</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../vscode-guide/index.html">Using VS Code</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../vscode-guide/example/index.html">Building an example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vscode-guide/next-steps/index.html">Using VS Code with a real project</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index.html">Tools and target features</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../describe-a-target-platform/platform.html">Describe a target platform</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../working-with-targets/index.html">Working with targets</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#key-target-based-features">Key target-based features</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#xtag">xTAG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#host-tools">Host tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#target-interaction">Target interaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#host-io">Host-IO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#xscope-apis">xSCOPE APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#user-supplied-host-program">User-supplied host program</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#sample-based-profiling-of-the-target-program">Sample-based profiling of the target program</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#target-errors-and-warnings">Target errors and warnings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#command-examples">Command examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design-with-flash/flash.html">Design and manufacture systems with flash memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../safeguard-ip/safeguard.html">Safeguard IP and device authenticity</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Add support for a new flash device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lpddr.html">Using LPDDR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../swmem.html">Using software-defined memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../args-and-ret-codes.html">How to use arguments and return codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using-xsim.html">Using XSIM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../understanding-xe-structure.html">Understanding XE files and how they are loaded</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tools-ref/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../tools-ref/cmd-line-tools/index.html">Command line tools</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xrun-manual/xrun-manual.html">XRUN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xsim-manual/xsim-manual.html">XSIM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xcc-manual/xcc-manual.html">XCC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xobjdump-manual/xobjdump-manual.html">XOBJDUMP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xgdb-manual/xgdb-manual.html">XGDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xgdbserver-manual/xgdbserver-manual.html">XGDBSERVER</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xflash-manual/xflash-manual.html">XFLASH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xburn-manual/xburn-manual.html">XBURN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xmake-manual/xmake-manual.html">XMAKE</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../tools-ref/formats/index.html">File formats and data descriptions</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/formats/xe.html">XMOS executable (XE) file format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/formats/xn-spec/xn-spec.html">XN specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/formats/xsim-trace.html">XSIM trace output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/formats/config-xscope.html">xSCOPE config file</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../tools-ref/xscope/index.html">xSCOPE</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xscope/xscope-command-line-options.html">xSCOPE command line options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xscope/xscope-performance.html">xSCOPE performance figures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xscope/xscope-target-library.html">xSCOPE target library</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xscope/xscope-host-library.html">xSCOPE host library</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../tools-ref/libraries/index.html">Libraries</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/lib-xcore-api/lib-xcore-api.html">lib_xcore</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../tools-ref/libraries/libxs1/lib-xs1-api.html">lib_xs1</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../tools-ref/libraries/libxs1/lib-xs1-defines-xs3a.html">XS3 definitions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../tools-ref/libraries/libxs1/lib-xs1-defines-xs2a.html">XS2 definitions</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/libflash-api/libflash-api.html">libflash API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/libquadflash-api/libquadflash-api.html">libquadflash API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/libflash-included-devices/libflash-devices.html">List of devices natively supported by libflash</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/libquadflash-included-devices/libquadflash-devices.html">List of devices natively supported by libquadflash</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/lib-otp-api/lib-otp-api.html">lib_otp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tools-ref/xcommon_cmake.html">XCommon CMake build system</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../tools-ref/xcommon/index.html">XCOMMON build system</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xcommon/using-makefiles.html">Using the XCOMMON build system</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xcommon/makefile-libraries.html">Using XMOS Makefiles to create binary libraries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tools-ref/transitioning/index.html">Transitioning from older tools releases</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../prog-guide/index.html">Programming guide</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../prog-guide/arch-hw-guide/index.html">Architecture &amp; hardware guide</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../prog-guide/quick-start/index.html">Quick start</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../prog-guide/quick-start/prog-model.html">The multicore programming model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../prog-guide/quick-start/c-programming-guide/index.html">Programming an XCORE tile with C and lib_xcore</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../prog-guide/prog-ref/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../prog-guide/prog-ref/programming-in-c-xc.html">Programming in C/XC</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/calling-between-c-xc/calling.html">Calling between C/C++ and XC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/xc-imp-defined-behavior/xc-imp.html">XC implementation-defined behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/c-imp-defined-behavior/c-imp.html">C implementation-defined behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/c-lang-ref/clangref.html">C and C++ language reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/xcc-pragma-directives/pragmas.html">XCC pragma directives</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/cheat.html">XC to C cheat sheet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/memory-models.html">Memory models</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../prog-guide/prog-ref/programming-in-asm.html">Programming in assembly</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/inline-assembly/inline-assembly.html">Inline assembly</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/assembly-for-xmos-xs1-abi/assembly-for-abi.html">Make assembly programs compatible with the XMOS XS1 ABI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/assembly-manual/assembly.html">Assembly programming manual</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../prog-guide/prog-ref/programming-xs1-devices.html">Programming for XCORE Devices</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/xs1-data-types/datatypes.html">xcore data types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/xs1-port-to-pin-map/portmap.html">xcore port-to-pin mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/xs1-abi/abi.html">XCORE 32-bit application binary interface</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="add-support-for-a-new-flash-device">
<span id="add-flash-support"></span><h1>Add support for a new flash device<a class="headerlink" href="#add-support-for-a-new-flash-device" title="Permalink to this heading">#</a></h1>
<p>This section describes supporting a new flash device using libflash or
libquadflash. libflash is a library implementing support for SPI flash
devices and libquadflash implements Quad SPI devices using a similar API.</p>
<p>To support a new flash device, a configuration file must be written that
describes the device characteristics, such as page size, number of pages
and commands for reading, writing and erasing data. This information can
be found in the datasheet for the flash device. Many devices available
in the market can be described using these configuration parameters;
those that cannot are unsupported.</p>
<p>The resulting configuration file can be used to support an unsupported
flash device within XFLASH, or used to write target software using
libflash or libquadflash directly.</p>
<p>The configuration file for the <a class="reference external" href="https://www.digikey.com/htmldatasheets/production/1338845/0/0/1/M25P10-A.pdf">Numonyx
M25P10-A</a>
is shown below. The device is described as an initializer for a C structure, the
values of which are described in the following sections.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span><span class="p">,</span>                     <span class="o">/*</span> <span class="mf">1.</span>  <span class="n">libflash</span> <span class="n">device</span> <span class="n">ID</span> <span class="o">*/</span>
<span class="mi">256</span><span class="p">,</span>                    <span class="o">/*</span> <span class="mf">2.</span>  <span class="n">Page</span> <span class="n">size</span> <span class="o">*/</span>
<span class="mi">512</span><span class="p">,</span>                    <span class="o">/*</span> <span class="mf">3.</span>  <span class="n">Number</span> <span class="n">of</span> <span class="n">pages</span> <span class="o">*/</span>
<span class="mi">3</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">4.</span>  <span class="n">Address</span> <span class="n">size</span> <span class="o">*/</span>
<span class="mi">4</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">5.</span>  <span class="n">Clock</span> <span class="n">divider</span> <span class="o">*/</span>
<span class="mh">0x9f</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">6.</span>  <span class="n">RDID</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mi">0</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">7.</span>  <span class="n">RDID</span> <span class="n">dummy</span> <span class="nb">bytes</span> <span class="o">*/</span>
<span class="mi">3</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">8.</span>  <span class="n">RDID</span> <span class="n">data</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">bytes</span> <span class="o">*/</span>
<span class="mh">0x202011</span><span class="p">,</span>               <span class="o">/*</span> <span class="mf">9.</span>  <span class="n">RDID</span> <span class="n">manufacturer</span> <span class="n">ID</span> <span class="o">*/</span>
<span class="mh">0xD8</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">10.</span> <span class="n">SE</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mi">0</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">11.</span> <span class="n">SE</span> <span class="n">full</span> <span class="n">sector</span> <span class="n">erase</span> <span class="o">*/</span>
<span class="mh">0x06</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">12.</span> <span class="n">WREN</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mh">0x04</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">13.</span> <span class="n">WRDI</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="n">PROT_TYPE_SR</span><span class="p">,</span>           <span class="o">/*</span> <span class="mf">14.</span> <span class="n">Protection</span> <span class="nb">type</span> <span class="o">*/</span>
<span class="p">{{</span><span class="mh">0x0c</span><span class="p">,</span><span class="mh">0x0</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">}},</span>     <span class="o">/*</span> <span class="mf">15.</span> <span class="n">SR</span> <span class="n">protect</span> <span class="ow">and</span> <span class="n">unprotect</span> <span class="n">cmds</span> <span class="o">*/</span>
<span class="mh">0x02</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">16.</span> <span class="n">PP</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mh">0x0b</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">17.</span> <span class="n">READ</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mi">1</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">18.</span> <span class="n">READ</span> <span class="n">dummy</span> <span class="nb">bytes</span> <span class="o">*/</span>
<span class="n">SECTOR_LAYOUT_REGULAR</span><span class="p">,</span>  <span class="o">/*</span> <span class="mf">19.</span> <span class="n">Sector</span> <span class="n">layout</span> <span class="o">*/</span>
<span class="p">{</span><span class="mi">32768</span><span class="p">,{</span><span class="mi">0</span><span class="p">,{</span><span class="mi">0</span><span class="p">}}},</span>        <span class="o">/*</span> <span class="mf">20.</span> <span class="n">Sector</span> <span class="n">sizes</span> <span class="o">*/</span>
<span class="mh">0x05</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">21.</span> <span class="n">RDSR</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mh">0x01</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">22.</span> <span class="n">WRSR</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mh">0x01</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">23.</span> <span class="n">WIP</span> <span class="n">bit</span> <span class="n">mask</span> <span class="o">*/</span>
<span class="mh">0x000000</span><span class="p">,</span>               <span class="o">/*</span> <span class="mf">24.</span> <span class="n">RDID</span> <span class="n">manufacturer</span> <span class="n">ID</span> <span class="n">bitmask</span> <span class="n">to</span> <span class="n">ignore</span> <span class="o">*/</span>
<span class="mi">0</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">25.</span> <span class="n">libquadflash</span><span class="p">:</span> <span class="n">QE</span> <span class="n">bit</span> <span class="n">location</span><span class="p">,</span> <span class="n">libflash</span><span class="p">:</span> <span class="n">Reserved</span> <span class="o">*/</span>
</pre></div>
</div>
<p>The configuration structure implements a form of parameter inheritance,
allowing for up to three sources of information. In order of priority, a
device configuration file can override any value obtained as a result of
SFDP query (for devices where this is available), which can override the
default configuration file.</p>
<p>The device configuration file is the most authoritative parameter set used
for establishing connection with the flash device. A device ID check is
performed against the configuration to match the correct file with the
attached flash device as described in <a class="reference internal" href="#add-flash-support-read-device-id"><span class="std std-ref">Read device ID</span></a>.</p>
<p>SFDP query is the second most authoritative source of information. Any
parameter values set as <code class="docutils literal notranslate"><span class="pre">-1</span></code> will be populated from the SFDP response
according to the <a class="reference internal" href="#add-flash-support-sfdp"><span class="std std-ref">SFDP</span></a> section, if available.</p>
<p>The final source of parameters is the default configuration file.
This contains a fallback set of parameters that are used when either a
specific device configuration cannot be matched, or when the device file
inherits values on a per-value basis from the default file, and the
parameter was not populated by SFDP.</p>
<p>By setting the libflash device ID to <code class="docutils literal notranslate"><span class="pre">-1</span></code>, the configuration file
describes the default set of parameters.</p>
<p>By setting the remaining parameters to <code class="docutils literal notranslate"><span class="pre">-1</span></code>, the value is inherited from
SFDP or the default configuration file, in that order.</p>
<p>The default configuration should not use the value of <code class="docutils literal notranslate"><span class="pre">-1</span></code> for the
remaining parameters, as there is nothing for it to inherit from. The
default configuration describes fallback parameters used when information
is missing from SFDP or the device configuration.</p>
<p>The values that can be currently populated from SFDP can be found in the
<a class="reference internal" href="#add-flash-support-sfdp"><span class="std std-ref">SFDP</span></a> section.</p>
<section id="libflash-device-id">
<span id="add-flash-support-libflash-device-id"></span><h2>Libflash device ID<a class="headerlink" href="#libflash-device-id" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span><span class="p">,</span> <span class="o">/*</span> <span class="mf">1.</span> <span class="n">libflash</span> <span class="n">device</span> <span class="n">ID</span> <span class="o">*/</span>
</pre></div>
</div>
<p>This value is returned by libflash on a call to the function <code class="docutils literal notranslate"><span class="pre">fl_getFlashType</span></code>
so that the application can identify the connected flash device.</p>
<p>If this value is set to <code class="docutils literal notranslate"><span class="pre">-1</span></code>, the configuration file describes the default
set of parameters.</p>
</section>
<section id="page-size-and-number-of-pages">
<span id="add-flash-support-page-size-and-number-of-pages"></span><h2>Page size and number of pages<a class="headerlink" href="#page-size-and-number-of-pages" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">256</span><span class="p">,</span>                    <span class="o">/*</span> <span class="mf">2.</span>  <span class="n">Page</span> <span class="n">size</span> <span class="o">*/</span>
<span class="mi">512</span><span class="p">,</span>                    <span class="o">/*</span> <span class="mf">3.</span>  <span class="n">Number</span> <span class="n">of</span> <span class="n">pages</span> <span class="o">*/</span>
</pre></div>
</div>
<p>These values specify the size of each page in bytes and the total number
of pages across all available sectors. On the M25P10-A datasheet, these
can be found from the following paragraph in section 1:</p>
<blockquote>
<div><p>The memory is organized as 4 sectors, each containing 128 pages.
Each page is 256 bytes wide. Thus, the whole memory can be viewed as
consisting of 512 pages, or 131,072 bytes.</p>
</div></blockquote>
</section>
<section id="address-size">
<span id="add-flash-support-address-size"></span><h2>Address size<a class="headerlink" href="#address-size" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">4.</span>  <span class="n">Address</span> <span class="n">size</span> <span class="o">*/</span>
</pre></div>
</div>
<p>This value specifies the number of bytes used to represent an address.
<a class="reference internal" href="#add-flash-support-tab4-m25p10a"><span class="std std-ref">Table 4 of M25P10-A datasheet</span></a> reproduces the part of the M25P10-A
datasheet that provides this information. In the table, all instructions
that require an address take three bytes.</p>
<div class="table-wrapper vertical-borders horizontal-borders smaller docutils container" id="id1">
<span id="add-flash-support-tab4-m25p10a"></span><span id="add-flash-support-tab4-m25p10a"></span><table class="vertical-borders horizontal-borders smaller docutils align-default" id="id1">
<caption><span class="caption-number">Table 2 </span><span class="caption-text">Table 4 of M25P10-A datasheet</span><a class="headerlink" href="#id1" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Instruction</p></th>
<th class="head"><p>Description</p></th>
<th class="head" colspan="2"><p>One-byte instruction</p></th>
<th class="head"><p>Address</p></th>
<th class="head"><p>Dummy</p></th>
<th class="head"><p>Data</p></th>
</tr>
<tr class="row-even"><th class="head"></th>
<th class="head"></th>
<th class="head" colspan="2"><p>code</p></th>
<th class="head"><p>byte</p></th>
<th class="head"><p>bytes</p></th>
<th class="head"><p>bytes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>WREN</p></td>
<td><p>Write Enable</p></td>
<td><p>0000 0110</p></td>
<td><p>06h</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>WRDI</p></td>
<td><p>Write Disable</p></td>
<td><p>0000 0100</p></td>
<td><p>04h</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>RDID</p></td>
<td><p>Read Identification</p></td>
<td><p>1001 1111</p></td>
<td><p>9Fh</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1 to 3</p></td>
</tr>
<tr class="row-even"><td><p>RDSR</p></td>
<td><p>Read Status Register</p></td>
<td><p>0000 0101</p></td>
<td><p>05h</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1 to infinity</p></td>
</tr>
<tr class="row-odd"><td><p>WRSR</p></td>
<td><p>Write Status Register</p></td>
<td><p>0000 0001</p></td>
<td><p>01h</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>READ</p></td>
<td><p>Read Data Bytes</p></td>
<td><p>0000 0011</p></td>
<td><p>03h</p></td>
<td><p>3</p></td>
<td><p>0</p></td>
<td><p>1 to infinity</p></td>
</tr>
<tr class="row-odd"><td><p>FAST_READ</p></td>
<td><p>Read Data Bytes at Higher Speed</p></td>
<td><p>0000 1011</p></td>
<td><p>0Bh</p></td>
<td><p>3</p></td>
<td><p>1</p></td>
<td><p>1 to infinity</p></td>
</tr>
<tr class="row-even"><td><p>PP</p></td>
<td><p>Page Program</p></td>
<td><p>0000 0010</p></td>
<td><p>02h</p></td>
<td><p>3</p></td>
<td><p>0</p></td>
<td><p>1 to 256</p></td>
</tr>
<tr class="row-odd"><td><p>SE</p></td>
<td><p>Sector Erase</p></td>
<td><p>1101 1000</p></td>
<td><p>D8h</p></td>
<td><p>3</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>BE</p></td>
<td><p>Bulk Erase</p></td>
<td><p>1100 0111</p></td>
<td><p>C7h</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>DP</p></td>
<td><p>Deep Power-down</p></td>
<td><p>1011 1001</p></td>
<td><p>B9h</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>RES</p></td>
<td><p>Release from Deep Power-down, and Read Electronic Signature</p></td>
<td rowspan="2"><p>1010 1011</p></td>
<td rowspan="2"><p>ABh</p></td>
<td><p>0</p></td>
<td><p>3</p></td>
<td><p>1 to  infinity</p></td>
</tr>
<tr class="row-odd"><td><p>Release from Deep Power-down</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="clock-divider">
<span id="add-flash-support-clock-rate"></span><h2>Clock divider<a class="headerlink" href="#clock-divider" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">4</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">5.</span>  <span class="n">Clock</span> <span class="n">divider</span> <span class="o">*/</span>
</pre></div>
</div>
<p>This value is used to determine the clock rate for interfacing with the
SPI device. For a value of <em>n</em>, the SPI clock rate used is 100/2*n MHz.
libflash supports a maximum of 12.5MHz.</p>
<p><a class="reference internal" href="#add-flash-support-tab18m25p10a"><span class="std std-ref">Table 18 of M25P10-A datasheet (first four entries only).</span></a> reproduces the part of the M25P10-A
datasheet that provides this information. The AC characteristics table
shows that all instructions used in the configuration file, as discussed
throughout this document, can operate at up to 25MHz. This is faster than
libflash can support, so the value 4 is provided to generate a 12.5MHz clock.</p>
<div class="table-wrapper vertical-borders horizontal-borders docutils container" id="id2">
<span id="add-flash-support-tab18m25p10a"></span><span id="add-flash-support-tab18m25p10a"></span><table class="vertical-borders horizontal-borders docutils align-default" id="id2">
<caption><span class="caption-number">Table 3 </span><span class="caption-text">Table 18 of M25P10-A datasheet (first four entries only).</span><a class="headerlink" href="#id2" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Alt.</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Typ</p></th>
<th class="head"><p>Max</p></th>
<th class="head"><p>Unit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>f <sub>C</sub></p></td>
<td><p>f <sub>C</sub></p></td>
<td><p>Clock frequency for the following instructions: FAST_READ, PP, SE, BE, DP, RES, WREN, WRDI, RDSR, WRSR</p></td>
<td><p>D.C.</p></td>
<td></td>
<td><p>25</p></td>
<td><p>MHz</p></td>
</tr>
<tr class="row-odd"><td><p>f <sub>R</sub></p></td>
<td></td>
<td><p>Clock frequency for READ instructions</p></td>
<td><p>D.C.</p></td>
<td></td>
<td><p>20</p></td>
<td><p>MHz</p></td>
</tr>
<tr class="row-even"><td><p>t <sub>CH</sub></p></td>
<td><p>t <sub>CLH</sub></p></td>
<td><p>Clock High time</p></td>
<td><p>18</p></td>
<td></td>
<td></td>
<td><p>ns</p></td>
</tr>
<tr class="row-odd"><td><p>t <sub>CL</sub></p></td>
<td><p>t <sub>CLL</sub></p></td>
<td><p>Clock Low time</p></td>
<td><p>18</p></td>
<td></td>
<td></td>
<td><p>ns</p></td>
</tr>
</tbody>
</table>
</div>
<p>In general, if the SPI device supports different clock rates for
different commands used by libflash, the lowest value must be specified.</p>
</section>
<section id="read-device-id">
<span id="add-flash-support-read-device-id"></span><h2>Read device ID<a class="headerlink" href="#read-device-id" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x9f</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">6.</span>  <span class="n">RDID</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mi">0</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">7.</span>  <span class="n">RDID</span> <span class="n">dummy</span> <span class="nb">bytes</span> <span class="o">*/</span>
<span class="mi">3</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">8.</span>  <span class="n">RDID</span> <span class="n">data</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">bytes</span> <span class="o">*/</span>
<span class="mh">0x202011</span><span class="p">,</span>               <span class="o">/*</span> <span class="mf">9.</span>  <span class="n">RDID</span> <span class="n">manufacturer</span> <span class="n">ID</span> <span class="o">*/</span>
<span class="o">..</span>
<span class="mh">0x000000</span>                <span class="o">/*</span> <span class="mf">24.</span> <span class="n">RDID</span> <span class="n">manufacturer</span> <span class="n">ID</span> <span class="n">bitmask</span> <span class="n">to</span> <span class="n">ignore</span> <span class="o">*/</span>
</pre></div>
</div>
<p>Most flash devices have a hardware identifier that can be used to
identify the device. This is used by libflash when one or more flash
devices are supported by the application to determine which type of
device is connected. The sequence for reading a device ID is typically
to issue an RDID (read ID) command, wait for zero or more dummy bytes,
and then read one or more bytes of data.</p>
<p><a class="reference internal" href="#add-flash-support-tab4-m25p10a"><span class="std std-ref">Table 4 of M25P10-A datasheet</span></a> reproduces the part of the
M25P10-A datasheet that provides this information. The row for the
instruction RDID shows that the command value is <code class="docutils literal notranslate"><span class="pre">0x9f</span></code>, that there
are no dummy bytes, and one to three data bytes. As shown in
<a class="reference internal" href="#add-flash-support-tab5-m25p10a"><span class="std std-ref">Table 5 of M25P10-A datasheet</span></a> and <a class="reference internal" href="#add-flash-support-fig9-m25p10a"><span class="std std-ref">Figure 9 of M25P10-A datasheet</span></a>,
the amount of data read depends on whether just the manufacturer ID
(first byte) is required, or whether both the manufacturer ID and the
device ID (second and third bytes) are required. All three bytes are
needed to uniquely identify the device, so the manufacturer ID is
specified as the three-byte value <code class="docutils literal notranslate"><span class="pre">0x202011</span></code>.</p>
<p>The bitmask of ID bits to ignore allows supporting a family of similar
flash devices with a single configuration. libflash will attempt
connection using the most specialised configurations first (those with
fewest bits set).</p>
<p>The bitmask and device ID fields are special in that they cannot be set
to <code class="docutils literal notranslate"><span class="pre">-1</span></code> to trigger inheritance - the value is considered to be set to
<code class="docutils literal notranslate"><span class="pre">0xffffffff</span></code>, which in the case of the bitmask, ignores all bits of
the device ID.</p>
<div class="table-wrapper vertical-borders horizontal-borders docutils container" id="id3">
<span id="add-flash-support-tab5-m25p10a"></span><span id="add-flash-support-tab5-m25p10a"></span><table class="vertical-borders horizontal-borders docutils align-default" id="id3">
<caption><span class="caption-number">Table 4 </span><span class="caption-text">Table 5 of M25P10-A datasheet</span><a class="headerlink" href="#id3" title="Permalink to this table">#</a></caption>
<tbody>
<tr class="row-odd"><td rowspan="2"><p><strong>Manufacturer identification</strong></p></td>
<td colspan="2"><p><strong>Device identification</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>Memory type</strong></p></td>
<td><p><strong>Memory capacity</strong></p></td>
</tr>
<tr class="row-odd"><td><p>20h</p></td>
<td><p>20h</p></td>
<td><p>11h</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-default" id="id4">
<span id="add-flash-support-fig9-m25p10a"></span><a class="reference internal image-reference" href="../../../_images/fl-m25p10a-fig9.png"><img alt="../../../_images/fl-m25p10a-fig9.png" src="../../../_images/fl-m25p10a-fig9.png" style="width: 120mm;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Figure 9 of M25P10-A datasheet</span><a class="headerlink" href="#id4" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>In general, if there is a choice of RDID commands then the JEDEC
compliant one should be preferred. Otherwise, the one returning the
longest ID should be used.</p>
</section>
<section id="sector-erase">
<span id="add-flash-support-sector-erase"></span><h2>Sector erase<a class="headerlink" href="#sector-erase" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0xD8</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">10.</span> <span class="n">SE</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mi">0</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">11.</span> <span class="n">SE</span> <span class="n">full</span> <span class="n">sector</span> <span class="n">erase</span> <span class="o">*/</span>
</pre></div>
</div>
<p>Most flash devices provide an instruction to erase all or part of a
sector.</p>
<p><a class="reference internal" href="#add-flash-support-tab4-m25p10a"><span class="std std-ref">Table 4 of M25P10-A datasheet</span></a> reproduces the part of the
M25P10-A datasheet that provides this information. The row for the
instruction SE shows that the command value is <code class="docutils literal notranslate"><span class="pre">0xd8</span></code>. On the M25P10-A
datasheet, the amount of data erased can be found from the first
paragraph of section 6.9:</p>
<blockquote>
<div><p>The Sector Erase (SE) instruction sets to ‘1’ (FFh) all bits inside
the chosen sector.</p>
</div></blockquote>
<p>In this example the SE command erases all of the sector, so the SE data
value is set to 0. If the number of bytes erased is less than a full
sector, this value should be set to the number of bytes erased.</p>
</section>
<section id="write-enable-disable">
<span id="add-flash-support-write-enable-disable"></span><h2>Write enable/disable<a class="headerlink" href="#write-enable-disable" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x06</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">12.</span> <span class="n">WREN</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mh">0x04</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">13.</span> <span class="n">WRDI</span> <span class="n">cmd</span> <span class="o">*/</span>
</pre></div>
</div>
<p>Most flash devices provide instructions to enable and disable writes to
memory. <a class="reference internal" href="#add-flash-support-tab4-m25p10a"><span class="std std-ref">Table 4 of M25P10-A datasheet</span></a> reproduces the part
of the M25P10-A datasheet that provides this information. The row for
the instruction WREN shows that the command value is <code class="docutils literal notranslate"><span class="pre">0x06</span></code>, and the
row for the instruction WRDI shows that the command value is <code class="docutils literal notranslate"><span class="pre">0x04</span></code>.</p>
</section>
<section id="memory-protection">
<span id="add-flash-support-memory-protection"></span><h2>Memory protection<a class="headerlink" href="#memory-protection" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PROT_TYPE_SR</span><span class="p">,</span>           <span class="o">/*</span> <span class="mf">14.</span> <span class="n">Protection</span> <span class="nb">type</span> <span class="o">*/</span>
<span class="p">{{</span><span class="mh">0x0c</span><span class="p">,</span><span class="mh">0x0</span><span class="p">},{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">}},</span>     <span class="o">/*</span> <span class="mf">15.</span> <span class="n">SR</span> <span class="n">protect</span> <span class="ow">and</span> <span class="n">unprotect</span> <span class="n">cmds</span> <span class="o">*/</span>
</pre></div>
</div>
<p>Some flash devices provide additional protection of sectors when writes
are enabled. For devices that support this capability, libflash attempts
to protect the flash image from being accidentally corrupted by the
application. The supported values for <em>protection</em> type are:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">PROT_TYPE_NONE</span></code></dt><dd><p>The device does not provide protection</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PROT_TYPE_SR</span></code></dt><dd><p>The device provides protection by writing the status register</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PROT_TYPE_SECS</span></code></dt><dd><p>The device provides commands to protect individual sectors</p>
</dd>
</dl>
<p>The protection details are specified as part of a construction of the
form:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">{{a,b},{c,d}}</span></code></p>
</div></blockquote>
<p>If the device does not provide protection, all values should be set to
0. If the device provides SR protection, <em>a</em> and <em>b</em> should be set to
the values to write to the SR to protect and unprotect the device, and
<em>c</em> and <em>d</em> to 0. Otherwise, <em>c</em> and <em>d</em> should be set to the values to
write to commands to protect and unprotect the device, and <em>a</em> and <em>b</em>
to 0.</p>
<p>If using SR protection, bit 30 of <em>a</em> and <em>b</em> can be set to enable a
read-modify-write method of accessing the status register. This prevents
clearing unrelated status bits. In this scenario, <em>b</em> is reinterpreted
and must otherwise contain the bitmask of bits to clear - usually the
same value set in <em>a</em>.</p>
<p><a class="reference internal" href="#add-flash-support-tab2-m25p10a"><span class="std std-ref">Table 2 of M25P10-A datasheet</span></a> and <a class="reference internal" href="#add-flash-support-tab6-m25p10a"><span class="std std-ref">Table 6 of M25P10-A datasheet</span></a>
reproduce the parts of the M25P10-A datasheet that provide this information.
The first table shows that BP0 and BP1 of the status register should be set to
1 to protect all sectors, and both to 0 to disable protection. The second table
shows that these are bits 2 and 3 of the SR.</p>
<div class="table-wrapper vertical-borders horizontal-borders smaller docutils container" id="id5">
<span id="add-flash-support-tab2-m25p10a"></span><span id="add-flash-support-tab2-m25p10a"></span><table class="vertical-borders horizontal-borders smaller docutils align-default" id="id5">
<caption><span class="caption-number">Table 5 </span><span class="caption-text">Table 2 of M25P10-A datasheet</span><a class="headerlink" href="#id5" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Status</p></th>
<th class="head" colspan="2"><p>Memory content</p></th>
</tr>
<tr class="row-even"><th class="head" colspan="2"><p>Register</p></th>
<th class="head" colspan="2"></th>
</tr>
<tr class="row-odd"><th class="head" colspan="2"><p>Content</p></th>
<th class="head" colspan="2"></th>
</tr>
<tr class="row-even"><th class="head"><p>BP1</p></th>
<th class="head"><p>BP0</p></th>
<th class="head"><p>Protected area</p></th>
<th class="head"><p>Unprotected area</p></th>
</tr>
<tr class="row-odd"><th class="head"><p>bit</p></th>
<th class="head"><p>bit</p></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>none</p></td>
<td><p>All sectors (four sectors: 0, 1, 2 and 3)</p></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>Upper quarter (sector 3)</p></td>
<td><p>Lower three-quarters (three sectors: 0 to 2)</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>0</p></td>
<td><p>Upper half (two sectors: 2 and 3)</p></td>
<td><p>Lower half (sectors 0 and 1)</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>All sectors (four sectors: 0, 1, 2 and 3)</p></td>
<td><p>none</p></td>
</tr>
</tbody>
</table>
</div>
<figure class="align-default" id="id6">
<span id="add-flash-support-tab6-m25p10a"></span><a class="reference internal image-reference" href="../../../_images/fl-m25p10a-tab6.png"><img alt="../../../_images/fl-m25p10a-tab6.png" src="../../../_images/fl-m25p10a-tab6.png" style="width: 120mm;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Table 6 of M25P10-A datasheet</span><a class="headerlink" href="#id6" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="programming-command">
<span id="add-flash-support-programming-command"></span><h2>Programming command<a class="headerlink" href="#programming-command" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x02</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">16.</span> <span class="n">PP</span> <span class="n">cmd</span> <span class="o">*/</span>
</pre></div>
</div>
<p>Devices are programmed either a page at a time or a small number of
bytes at a time. If page programming is available it should be used, as
it minimizes the amount of data transmitted over the SPI interface.</p>
<p><a class="reference internal" href="#add-flash-support-tab4-m25p10a"><span class="std std-ref">Table 4 of M25P10-A datasheet</span></a> reproduces the part of the
M25P10-A datasheet that provides this information. In the table, a page
program command is provided and has the value <code class="docutils literal notranslate"><span class="pre">0x02</span></code>.</p>
<p>If page programming is not supported, this value is a concatenation of
three separate values. Bits 0..7 must be set to 0. Bits 8..15 should
contain the program command. Bits 16..23 should contain the number of
bytes per command. The libflash library requires that the first program
command accepts a three byte address but subsequent program command use
auto address increment (AAI).</p>
<p>An example of a device without a PP command is the <a class="reference external" href="https://www.farnell.com/datasheets/52728.pdf">ESMT
F25L004A</a>.
<a class="reference internal" href="#add-flash-support-tab7-f25l004a"><span class="std std-ref">Table 7 of F25L004A datasheet.</span></a> reproduces the part of the F25L004A
datasheet that provides this information. In the timing diagram, the AAI
command has a value <code class="docutils literal notranslate"><span class="pre">0xad</span></code>, followed by a three-byte address and two
bytes of data.</p>
<div class="table-wrapper vertical-borders horizontal-borders docutils container" id="id7">
<span id="add-flash-support-tab7-f25l004a"></span><span id="add-flash-support-tab7-f25l004a"></span><table class="vertical-borders horizontal-borders docutils align-default" id="id7">
<caption><span class="caption-number">Table 6 </span><span class="caption-text">Table 7 of F25L004A datasheet.</span><a class="headerlink" href="#id7" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Minimum</p></th>
<th class="head"><p>Units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>T <sub>PU-READ</sub></p></td>
<td><p>V <sub>DD</sub> Min to Read Operation</p></td>
<td><p>10</p></td>
<td><p>us</p></td>
</tr>
<tr class="row-odd"><td><p>T <sub>PU-WRITE</sub></p></td>
<td><p>V <sub>DD</sub>  Min to Write Operation</p></td>
<td><p>10</p></td>
<td><p>us</p></td>
</tr>
</tbody>
</table>
</div>
<p>The corresponding entry in the specification file is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x00</span><span class="o">|</span><span class="p">(</span><span class="mh">0xad</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">2</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">),</span> <span class="o">/*</span> <span class="n">No</span> <span class="n">PP</span><span class="p">,</span> <span class="n">have</span> <span class="n">AAI</span> <span class="k">for</span> <span class="mi">2</span> <span class="nb">bytes</span> <span class="o">*/</span>
</pre></div>
</div>
</section>
<section id="read-data">
<span id="add-flash-support-read-data"></span><h2>Read data<a class="headerlink" href="#read-data" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x0b</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">17.</span> <span class="n">READ</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mi">1</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">18.</span> <span class="n">READ</span> <span class="n">dummy</span> <span class="nb">bytes</span> <span class="o">*/</span>
</pre></div>
</div>
<p>The sequence for reading data from a device is typically to issue a READ
command, wait for zero or more dummy bytes, and then read one or more
bytes of data.</p>
<p>For libquadflash, command bits 0..7 denote the QUAD_READ command, typically
<code class="docutils literal notranslate"><span class="pre">0xeb</span></code>. Bits 8..15 can be used to set a READ or FAST_READ command but this
defaults to <code class="docutils literal notranslate"><span class="pre">0x0b</span></code> for FAST_READ.</p>
<p><a class="reference internal" href="#add-flash-support-tab4-m25p10a"><span class="std std-ref">Table 4 of M25P10-A datasheet</span></a> reproduces the part of the
M25P10-A datasheet that provides this information. There are two
commands that can be used to read data: READ and FAST_READ. The row for
the instruction FAST_READ shows that the command value is <code class="docutils literal notranslate"><span class="pre">0x0b</span></code>,
followed by one dummy byte.</p>
</section>
<section id="sector-information">
<span id="add-flash-support-sector-information"></span><h2>Sector information<a class="headerlink" href="#sector-information" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SECTOR_LAYOUT_REGULAR</span><span class="p">,</span>  <span class="o">/*</span> <span class="mf">19.</span> <span class="n">Sector</span> <span class="n">layout</span> <span class="o">*/</span>
<span class="p">{</span><span class="mi">32768</span><span class="p">,{</span><span class="mi">0</span><span class="p">,{</span><span class="mi">0</span><span class="p">}}},</span>        <span class="o">/*</span> <span class="mf">20.</span> <span class="n">Sector</span> <span class="n">sizes</span> <span class="o">*/</span>
</pre></div>
</div>
<p>The first value specifies whether all sectors are the same size. The
supported values are:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">SECTOR_LAYOUT_REGULAR</span></code></dt><dd><p>The sectors all have the same size</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SECTOR_LAYOUT_IRREGULAR</span></code></dt><dd><p>The sectors have different sizes</p>
</dd>
</dl>
<p>On the M25P10-A datasheet, this can be found from the following
paragraph in section 5:</p>
<blockquote>
<div><p>The memory is organized as:</p>
<ul class="simple">
<li><p>131,072 bytes (8 bits each)</p></li>
<li><p>4 sectors (256 Kbits, 32768 bytes each)</p></li>
<li><p>512 pages (256 bytes each).</p></li>
</ul>
</div></blockquote>
<p>The sector sizes is specified as part of a construction:
<code class="docutils literal notranslate"><span class="pre">{a,</span> <span class="pre">{b,</span> <span class="pre">{c}}}</span></code>. For regular sector sizes, the size is specified in
<em>a</em>. The values of <em>b</em> and <em>c</em> should be 0.</p>
<p>For irregular sector sizes,
the size number of sectors is specified in <em>b</em>. The log base 2 of the
number of pages in each sector is specified in c. The value of <em>a</em>
should be 0. An example of a device with irregular sectors is the <cite>AMIC
A25L80P.
:ref:`add_flash_support_tab2_a25l80p</cite> reproduces the part of this
datasheet that provides the sector information.</p>
<div class="table-wrapper vertical-borders horizontal-borders docutils container" id="id8">
<span id="add-flash-support-tab2-a25l80p"></span><span id="add-flash-support-tab2-a25l80p"></span><table class="vertical-borders horizontal-borders docutils align-default" id="id8">
<caption><span class="caption-number">Table 7 </span><span class="caption-text">Table 2 of A25L80P datasheet</span><a class="headerlink" href="#id8" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Sector</p></th>
<th class="head"><p>Sector Size (Kb)</p></th>
<th class="head" colspan="2"><p>Address Range</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>15</p></td>
<td><p>64</p></td>
<td><p>F0000h</p></td>
<td><p>FFFFFh</p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p>64</p></td>
<td><p>E0000h</p></td>
<td><p>EFFFFh</p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>64</p></td>
<td><p>D0000h</p></td>
<td><p>DFFFFh</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>64</p></td>
<td><p>C0000h</p></td>
<td><p>CFFFFh</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>64</p></td>
<td><p>B0000h</p></td>
<td><p>BFFFFh</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>64</p></td>
<td><p>A0000h</p></td>
<td><p>AFFFFh</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>64</p></td>
<td><p>90000h</p></td>
<td><p>9FFFFh</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>64</p></td>
<td><p>80000h</p></td>
<td><p>8FFFFh</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>64</p></td>
<td><p>70000h</p></td>
<td><p>7FFFFh</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>64</p></td>
<td><p>60000h</p></td>
<td><p>6FFFFh</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>64</p></td>
<td><p>50000h</p></td>
<td><p>5FFFFh</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>64</p></td>
<td><p>40000h</p></td>
<td><p>4FFFFh</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>64</p></td>
<td><p>30000h</p></td>
<td><p>3FFFFh</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>64</p></td>
<td><p>20000h</p></td>
<td><p>2FFFFh</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>64</p></td>
<td><p>10000h</p></td>
<td><p>1FFFFh</p></td>
</tr>
<tr class="row-odd"><td><p>0-4</p></td>
<td><p>32</p></td>
<td><p>08000h</p></td>
<td><p>0FFFFh</p></td>
</tr>
<tr class="row-even"><td><p>0-3</p></td>
<td><p>16</p></td>
<td><p>04000h</p></td>
<td><p>07FFFh</p></td>
</tr>
<tr class="row-odd"><td><p>0-2</p></td>
<td><p>8</p></td>
<td><p>02000h</p></td>
<td><p>03FFFh</p></td>
</tr>
<tr class="row-even"><td><p>0-1</p></td>
<td><p>4</p></td>
<td><p>01000h</p></td>
<td><p>01FFFh</p></td>
</tr>
<tr class="row-odd"><td><p>0-0</p></td>
<td><p>4</p></td>
<td><p>00000h</p></td>
<td><p>00FFFh</p></td>
</tr>
</tbody>
</table>
</div>
<p>The corresponding entry in the specification file is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SECTOR_LAYOUT_IRREGULAR</span><span class="p">,</span>
    <span class="p">{</span><span class="mi">0</span><span class="p">,{</span><span class="mi">20</span><span class="p">,{</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">}}},</span>
</pre></div>
</div>
</section>
<section id="status-register-bits">
<span id="add-flash-support-status-register-bits"></span><h2>Status register bits<a class="headerlink" href="#status-register-bits" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x05</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">21.</span> <span class="n">RDSR</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mh">0x01</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">22.</span> <span class="n">WRSR</span> <span class="n">cmd</span> <span class="o">*/</span>
<span class="mh">0x01</span><span class="p">,</span>                   <span class="o">/*</span> <span class="mf">23.</span> <span class="n">WIP</span> <span class="n">bit</span> <span class="n">mask</span> <span class="o">*/</span>
</pre></div>
</div>
<p>Most flash devices provide instructions to read and write a status
register, including a write-in-progress bit mask.</p>
<p><a class="reference internal" href="#add-flash-support-tab4-m25p10a"><span class="std std-ref">Table 4 of M25P10-A datasheet</span></a> reproduces the part of the
M25P10-A datasheet that documents the RDSR and WRSR commands. The
diagram in <a class="reference internal" href="#add-flash-support-tab6-m25p10a"><span class="std std-ref">Table 6 of M25P10-A datasheet</span></a> shows that the WIP
bit is in bit position 0 of the SR, resulting in a bit mask of <code class="docutils literal notranslate"><span class="pre">0x01</span></code>.</p>
</section>
<section id="quad-enable-bit">
<h2>Quad enable bit<a class="headerlink" href="#quad-enable-bit" title="Permalink to this heading">#</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span><span class="p">,</span>                      <span class="o">/*</span> <span class="mf">25.</span> <span class="n">libquadflash</span><span class="p">:</span> <span class="n">QE</span> <span class="n">bit</span> <span class="n">location</span><span class="p">,</span> <span class="n">libflash</span><span class="p">:</span> <span class="n">Reserved</span> <span class="o">*/</span>
</pre></div>
</div>
<p>For Quad SPI devices, an additional field is provided for encoding
the location of the Quad Enable bit. This field is reserved and has
no effect when using libflash for a SPI device.</p>
<p>Bits 0..1 of this field describe the method used to set the bit:</p>
<div class="table-wrapper vertical-borders horizontal-borders docutils container" id="id9">
<table class="vertical-borders horizontal-borders docutils align-default" id="id9">
<caption><span class="caption-number">Table 8 </span><span class="caption-text">Quad Enable method</span><a class="headerlink" href="#id9" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Read-modify-write</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Legacy libquadflash behavior</p></td>
<td><p>Set bit 6 in register 0 if manufacturer ID is ISSI or MACRONIX, otherwise set bit 1 in register 1</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Bit position override</p></td>
<td><p>Set bit stored in bits 8..15 in register stored in bits 0..7, using the WRSR command</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>SFDP requirements</p></td>
<td><p>Set bit according to JEDEC Quad Enable Requirements (QER) value stored in bits 24..26</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>No QE bit</p></td>
<td><p>Does not attempt to set a QE bit</p></td>
<td><p>N/A</p></td>
</tr>
</tbody>
</table>
</div>
<p>It is not recommended to override this field as the default behavior
attempts SFDP query to derive a value using method 2. The value can
be left as <code class="docutils literal notranslate"><span class="pre">-1</span></code> to inherit from the SFDP query. This field is provided
for devices that do not support SFDP query.</p>
<p>Note that XFLASH will populate this field with the QE bit position
override, if any, stored in the XN file. This will couple the
application XE file to a particular flash device, which may be
undesirable. It is recommended to remove the QE bit location from
the XN file for systems supporting SFDP.</p>
<p>If a method supports read-modify-write, other bits of the status
register will be preserved when setting the QE bit.</p>
</section>
<section id="sfdp">
<span id="add-flash-support-sfdp"></span><h2>SFDP<a class="headerlink" href="#sfdp" title="Permalink to this heading">#</a></h2>
<p>libquadflash implements a basic level of support for JEDEC JESD216
Serial Flash Discoverable Parameters (SFDP). This automatically
populates the flash configuration structure with values obtained
from the attached flash device at runtime, reducing the need to
manually specify some properties of the device.</p>
<p>The currently supported SFDP parameters and mappings include:</p>
<ul class="simple">
<li><p>Quad Enable Requirements: 25 (quadEnable).</p></li>
<li><p>Flash Memory Density: 3 (numPages).</p></li>
<li><p>Page Size: 2 (pageSize).</p></li>
</ul>
<p>To use this feature, the associated field in the device configuration
file (if any) must be set to <code class="docutils literal notranslate"><span class="pre">-1</span></code> to inherit the value from the SFDP
query. Any other value will override the result of the query.</p>
</section>
<section id="select-a-flash-device">
<span id="add-flash-support-select-flash-device"></span><h2>Select a flash device<a class="headerlink" href="#select-a-flash-device" title="Permalink to this heading">#</a></h2>
<p>When selecting a flash device for use with an xCORE device, the following
guidelines are recommended:</p>
<ul class="simple">
<li><p>If access to the data partition is required, select a device with
fine-grained erase granularity, as this will minimize the gaps
between the factory and upgrade images, and will also minimize the
amount of data that libflash needs to buffer when writing data.</p></li>
<li><p>Select a device with sector protection if possible, to ensure that
the bootloader and factory image are protected from accidental
corruption post-deployment.</p></li>
<li><p>Select a flash speed grade suitable for the application. Boot times
are minimal even at low speeds.</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../lpddr.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Using LPDDR</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../safeguard-ip/safeguard.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Safeguard IP and device authenticity</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, XMOS Ltd
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Jul 24, 2024</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Add support for a new flash device</a><ul>
<li><a class="reference internal" href="#libflash-device-id">Libflash device ID</a></li>
<li><a class="reference internal" href="#page-size-and-number-of-pages">Page size and number of pages</a></li>
<li><a class="reference internal" href="#address-size">Address size</a></li>
<li><a class="reference internal" href="#clock-divider">Clock divider</a></li>
<li><a class="reference internal" href="#read-device-id">Read device ID</a></li>
<li><a class="reference internal" href="#sector-erase">Sector erase</a></li>
<li><a class="reference internal" href="#write-enable-disable">Write enable/disable</a></li>
<li><a class="reference internal" href="#memory-protection">Memory protection</a></li>
<li><a class="reference internal" href="#programming-command">Programming command</a></li>
<li><a class="reference internal" href="#read-data">Read data</a></li>
<li><a class="reference internal" href="#sector-information">Sector information</a></li>
<li><a class="reference internal" href="#status-register-bits">Status register bits</a></li>
<li><a class="reference internal" href="#quad-enable-bit">Quad enable bit</a></li>
<li><a class="reference internal" href="#sfdp">SFDP</a></li>
<li><a class="reference internal" href="#select-a-flash-device">Select a flash device</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    </body>
</html>