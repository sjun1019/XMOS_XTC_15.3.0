<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Safeguard IP and device authenticity" href="../safeguard-ip/safeguard.html" /><link rel="prev" title="Introduction" href="../working-with-targets/intro.html" />

    <link rel="shortcut icon" href="../../../_static/x-favicon.png"/><!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>Design and manufacture systems with flash memory - XMOS XTC Tools v15.3</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #1399DB;
  --color-brand-content: #1399DB;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #1399DB;
  --color-brand-content: #1399DB;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #1399DB;
  --color-brand-content: #1399DB;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">XMOS XTC Tools v15.3</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/x-logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">XMOS XTC Tools v15.3</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><!-- This html element presents a list of pdfs that can be generated -->
<!-- We expect pdfs to be in a folder called pdf alongside the folder called html -->

<!-- TODO: generate this list using JS only for real pdfs that exist -->

<!-- pathto(root_doc) set by sphinx for each page, but root doc has # -->

<div id="pdf_linker">
    <script>
        function openPDF(url) {
            if (url=="--select--") {
                return;
            }
            window.location.href = url;
        }
    </script>
    PDFs:
    <select title="Link to generated pdfs" onchange="openPDF(value);">
        <option>--select--</option>
        
        <option
            title="xtc_tools_introduction_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_tools_introduction_v15.3.pdf"
        >
            XMOS XTC Tools - Introduction
        </option> 
        
        <option
            title="xtc_tools_installation_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_tools_installation_v15.3.pdf"
        >
            XMOS XTC Tools - Installation
        </option> 
        
        <option
            title="xtc_tools_guide_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_tools_guide_v15.3.pdf"
        >
            XMOS XTC Tools - Tools Guide
        </option> 
        
        <option
            title="xtc_prog_guide_v15.3.pdf"
            value="../../../index.html/../../pdf/xtc_prog_guide_v15.3.pdf"
        >
            XMOS XTC Tools - Programming Guide
        </option> 
        
    </select>
</div>
<div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../intro/index.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../installation/index.html">Installation guide</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/system-requirements/requirements.html">System requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/install-tools/install.html">Installation instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/install-tools/install_prerequisites.html">Installation of required third-party tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/install-configure/getting-started.html">Configuring the command-line environment</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../index.html">Tools guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../../quick-start/index.html">Quick start</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/single-tile.html">A single-tile program</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/multi-tile.html">Targeting multiple tiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/switch-setup.html">Communicating between tiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/fast-printf.html">Using xSCOPE for fast “printf debugging”</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/debug.html">Debugging with XGDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../quick-start/build-system.html">Build system</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../vscode-guide/index.html">Using VS Code</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../vscode-guide/example/index.html">Building an example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vscode-guide/next-steps/index.html">Using VS Code with a real project</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="../index.html">Tools and target features</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../describe-a-target-platform/platform.html">Describe a target platform</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../working-with-targets/index.html">Working with targets</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#key-target-based-features">Key target-based features</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#xtag">xTAG</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#host-tools">Host tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#target-interaction">Target interaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#host-io">Host-IO</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#xscope-apis">xSCOPE APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#user-supplied-host-program">User-supplied host program</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#sample-based-profiling-of-the-target-program">Sample-based profiling of the target program</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#target-errors-and-warnings">Target errors and warnings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../working-with-targets/intro.html#command-examples">Command examples</a></li>
</ul>
</li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Design and manufacture systems with flash memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../safeguard-ip/safeguard.html">Safeguard IP and device authenticity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../add-flash-support/flash.html">Add support for a new flash device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lpddr.html">Using LPDDR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../swmem.html">Using software-defined memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../args-and-ret-codes.html">How to use arguments and return codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using-xsim.html">Using XSIM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../understanding-xe-structure.html">Understanding XE files and how they are loaded</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../tools-ref/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../tools-ref/cmd-line-tools/index.html">Command line tools</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xrun-manual/xrun-manual.html">XRUN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xsim-manual/xsim-manual.html">XSIM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xcc-manual/xcc-manual.html">XCC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xobjdump-manual/xobjdump-manual.html">XOBJDUMP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xgdb-manual/xgdb-manual.html">XGDB</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xgdbserver-manual/xgdbserver-manual.html">XGDBSERVER</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xflash-manual/xflash-manual.html">XFLASH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xburn-manual/xburn-manual.html">XBURN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/cmd-line-tools/xmake-manual/xmake-manual.html">XMAKE</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../tools-ref/formats/index.html">File formats and data descriptions</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/formats/xe.html">XMOS executable (XE) file format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/formats/xn-spec/xn-spec.html">XN specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/formats/xsim-trace.html">XSIM trace output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/formats/config-xscope.html">xSCOPE config file</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../tools-ref/xscope/index.html">xSCOPE</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xscope/xscope-command-line-options.html">xSCOPE command line options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xscope/xscope-performance.html">xSCOPE performance figures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xscope/xscope-target-library.html">xSCOPE target library</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xscope/xscope-host-library.html">xSCOPE host library</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../tools-ref/libraries/index.html">Libraries</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/lib-xcore-api/lib-xcore-api.html">lib_xcore</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../tools-ref/libraries/libxs1/lib-xs1-api.html">lib_xs1</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../tools-ref/libraries/libxs1/lib-xs1-defines-xs3a.html">XS3 definitions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../tools-ref/libraries/libxs1/lib-xs1-defines-xs2a.html">XS2 definitions</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/libflash-api/libflash-api.html">libflash API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/libquadflash-api/libquadflash-api.html">libquadflash API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/libflash-included-devices/libflash-devices.html">List of devices natively supported by libflash</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/libquadflash-included-devices/libquadflash-devices.html">List of devices natively supported by libquadflash</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/libraries/lib-otp-api/lib-otp-api.html">lib_otp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tools-ref/xcommon_cmake.html">XCommon CMake build system</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../tools-ref/xcommon/index.html">XCOMMON build system</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xcommon/using-makefiles.html">Using the XCOMMON build system</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../tools-ref/xcommon/makefile-libraries.html">Using XMOS Makefiles to create binary libraries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../tools-ref/transitioning/index.html">Transitioning from older tools releases</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../prog-guide/index.html">Programming guide</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../prog-guide/arch-hw-guide/index.html">Architecture &amp; hardware guide</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../prog-guide/quick-start/index.html">Quick start</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../prog-guide/quick-start/prog-model.html">The multicore programming model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../prog-guide/quick-start/c-programming-guide/index.html">Programming an XCORE tile with C and lib_xcore</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../prog-guide/prog-ref/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../prog-guide/prog-ref/programming-in-c-xc.html">Programming in C/XC</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/calling-between-c-xc/calling.html">Calling between C/C++ and XC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/xc-imp-defined-behavior/xc-imp.html">XC implementation-defined behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/c-imp-defined-behavior/c-imp.html">C implementation-defined behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/c-lang-ref/clangref.html">C and C++ language reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/xcc-pragma-directives/pragmas.html">XCC pragma directives</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/cheat.html">XC to C cheat sheet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/memory-models.html">Memory models</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../prog-guide/prog-ref/programming-in-asm.html">Programming in assembly</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/inline-assembly/inline-assembly.html">Inline assembly</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/assembly-for-xmos-xs1-abi/assembly-for-abi.html">Make assembly programs compatible with the XMOS XS1 ABI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/assembly-manual/assembly.html">Assembly programming manual</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../prog-guide/prog-ref/programming-xs1-devices.html">Programming for XCORE Devices</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/xs1-data-types/datatypes.html">xcore data types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/xs1-port-to-pin-map/portmap.html">xcore port-to-pin mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../prog-guide/prog-ref/xs1-abi/abi.html">XCORE 32-bit application binary interface</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div></div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="design-and-manufacture-systems-with-flash-memory">
<span id="design-with-flash"></span><h1>Design and manufacture systems with flash memory<a class="headerlink" href="#design-and-manufacture-systems-with-flash-memory" title="Permalink to this heading">#</a></h1>
<p>The tools can be used to target xCORE devices that use Quad SPI or SPI
flash memory for booting and persistent storage.</p>
<p>By default XFLASH fully supports a range of <a class="reference internal" href="../../tools-ref/libraries/libquadflash-included-devices/libquadflash-devices.html#libquadflash-included-devices"><span class="std std-ref">Quad SPI</span></a>
and <a class="reference internal" href="../../tools-ref/libraries/libflash-included-devices/libflash-devices.html#libflash-included-devices"><span class="std std-ref">SPI</span></a> devices implemented
in <code class="docutils literal notranslate"><span class="pre">libquadflash</span></code> and <code class="docutils literal notranslate"><span class="pre">libflash</span></code> respectively.
If the number of pages, page size and sector size are specified in the
<a class="reference internal" href="../../tools-ref/formats/xn-spec/xn-spec.html#xn-spec-device"><span class="std std-ref">XN file</span></a> - or the flash device supports
<a class="reference internal" href="../add-flash-support/flash.html#add-flash-support-sfdp"><span class="std std-ref">SFDP</span></a> - XFLASH can easily support significantly
many more devices available on the market.</p>
<p>For some devices, particularly SPI flash devices, additional manual
configuration in reference to the device’s datasheet as described in
the <a class="reference internal" href="../add-flash-support/flash.html#add-flash-support"><span class="std std-ref">Add support for a new flash device</span></a> section may be required for XFLASH to
fully support the flash device.
This configuration file can be specified to XFLASH using the <code class="docutils literal notranslate"><span class="pre">--spi-spec</span></code>
option.</p>
<p>The same configuration file provided to XFLASH can also be used to develop
target software which accesses persistent storage on the flash device
using the <code class="docutils literal notranslate"><span class="pre">libquadflash</span></code> and <code class="docutils literal notranslate"><span class="pre">libflash</span></code> libraries.</p>
<p>The xCORE flash format is shown in <a class="reference internal" href="#design-with-flash-flash-format-diagram"><span class="std std-ref">Flash format diagram</span></a>.</p>
<figure class="align-default" id="id2">
<span id="design-with-flash-flash-format-diagram"></span><img alt="../../../_images/flash-format1.png" src="../../../_images/flash-format1.png" />
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">Flash format diagram</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The flash memory is logically split between a boot and data partition.
The boot partition consists of a flash loader followed by a “factory
image” and zero or more optional “upgrade images.” Each image starts
with a descriptor that contains a unique version number, a header that
contains a table of code/data segments for each tile used by the program
and a CRC. By default, the flash loader boots the image with the highest
version with a valid CRC.</p>
<section id="boot-a-program-from-flash-memory">
<span id="design-with-flash-boot-from-flash"></span><h2>Boot a program from flash memory<a class="headerlink" href="#boot-a-program-from-flash-memory" title="Permalink to this heading">#</a></h2>
<p>To load a program into an SPI flash memory device on your development
board, <a class="reference internal" href="../../../installation/install-configure/getting-started.html#get-started-start-the-command-line-tools"><span class="std std-ref">start the tools</span></a>
and enter the following commands:</p>
<blockquote>
<div><ol class="arabic">
<li><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xflash<span class="w"> </span>-l
</pre></div>
</div>
<p>XFLASH prints an enumerated list of all JTAG adapters connected to
your PC and the devices on each JTAG chain, in the form:</p>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">ID</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Name</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Adapter</span> <span class="pre">ID</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">Devices</span></code></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">--</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">----</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">----------</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">-------</span></code></div>
</div>
</li>
<li><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xflash<span class="w"> </span>--id<span class="w"> </span>&lt;id&gt;<span class="w"> </span>a.xe
</pre></div>
</div>
<p>XFLASH generates an image in the xCORE flash format that contains a
first stage loader and factory image comprising the binary and data
segments from your compiled program. It then writes this image to
flash memory using the xCORE device.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The XN file used to compile your program must define an SPI flash
device and specify the four ports of the xCORE device to which it is
connected.</p>
</div>
</li>
</ol>
</div></blockquote>
</section>
<section id="generate-a-flash-image-for-manufacture">
<span id="design-with-flash-generate-flash-image"></span><h2>Generate a flash image for manufacture<a class="headerlink" href="#generate-a-flash-image-for-manufacture" title="Permalink to this heading">#</a></h2>
<p>In manufacturing environments, the same program is typically programmed
into multiple flash devices.</p>
<p>To generate an image file in the xCORE flash format, which can be
subsequently programmed into flash devices,
<a class="reference internal" href="../../../installation/install-configure/getting-started.html#get-started-start-the-command-line-tools"><span class="std std-ref">start the tools</span></a>
and enter the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xflash<span class="w"> </span>a.xe<span class="w"> </span>-o<span class="w"> </span>image-file
</pre></div>
</div>
<p>XFLASH generates an image comprising a first stage loader and your
program as the factory image, which it writes to the specified file.</p>
</section>
<section id="perform-an-in-field-upgrade">
<span id="design-with-flash-perform-in-field-upgrade"></span><h2>Perform an in-field upgrade<a class="headerlink" href="#perform-an-in-field-upgrade" title="Permalink to this heading">#</a></h2>
<p>The tools and the flash libraries libquadflash and libflash
let you manage multiple firmware upgrades over the life cycle of your product.
You can use XFLASH to create an upgrade image and, from within your program,
use libflash to write this image to the boot partition. Using libflash,
updates are robust against partially complete writes, for example due to power
failure: if the CRC of the upgrade image fails during boot, the previous
image is loaded instead.</p>
<section id="write-a-program-that-upgrades-itself-using-quad-spi-devices">
<span id="design-with-flash-write-program-that-upgrades-itself"></span><h3>Write a program that upgrades itself using Quad SPI devices<a class="headerlink" href="#write-a-program-that-upgrades-itself-using-quad-spi-devices" title="Permalink to this heading">#</a></h3>
<p>The example program below uses the libquadflash library to upgrade itself.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;platform.h&gt;</span>
<span class="c1">#include &lt;quadflash.h&gt;</span>

<span class="c1">#define MAX_PSIZE 256</span>

<span class="o">/*</span> <span class="n">initializers</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">XN</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">available</span> <span class="n">via</span> <span class="n">platform</span><span class="o">.</span><span class="n">h</span> <span class="o">*/</span>

<span class="n">fl_QSPIPorts</span> <span class="n">QSPI</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">PORT_SQI_CS</span><span class="p">,</span>
  <span class="n">PORT_SQI_CLK</span><span class="p">,</span>
  <span class="n">PORT_SQI_SIO</span><span class="p">,</span>
  <span class="n">XS1_CLKBLK_1</span>
<span class="p">};</span>

<span class="nb">int</span> <span class="n">upgrade</span><span class="p">(</span><span class="n">chanend</span> <span class="n">c</span><span class="p">,</span> <span class="nb">int</span> <span class="n">usize</span><span class="p">)</span> <span class="p">{</span>

 <span class="o">/*</span> <span class="n">Obtain</span> <span class="n">an</span> <span class="n">upgrade</span> <span class="n">image</span> <span class="ow">and</span> <span class="n">write</span>
  <span class="o">*</span> <span class="n">it</span> <span class="n">to</span> <span class="n">flash</span> <span class="n">memory</span><span class="o">.</span>
  <span class="o">*</span> <span class="n">Error</span> <span class="n">checking</span> <span class="n">omitted</span> <span class="o">*/</span>

 <span class="n">fl_BootImageInfo</span> <span class="n">b</span><span class="p">;</span>
 <span class="n">unsigned</span> <span class="n">char</span> <span class="n">page</span><span class="p">[</span><span class="n">MAX_PSIZE</span><span class="p">];</span>
 <span class="nb">int</span> <span class="n">psize</span><span class="p">;</span>

 <span class="n">fl_connect</span><span class="p">(</span><span class="n">QSPI</span><span class="p">);</span>

 <span class="n">psize</span> <span class="o">=</span> <span class="n">fl_getPageSize</span><span class="p">();</span>
 <span class="n">fl_getFactoryImage</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
 <span class="k">if</span><span class="p">(</span><span class="n">fl_getNextBootImage</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">while</span><span class="p">(</span><span class="n">fl_startImageReplace</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">usize</span><span class="p">));</span>
 <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
   <span class="k">while</span><span class="p">(</span><span class="n">fl_startImageAdd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">usize</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
 <span class="p">}</span>

 <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">usize</span><span class="o">/</span><span class="n">psize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">for</span> <span class="p">(</span><span class="nb">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">psize</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">c</span> <span class="p">:</span><span class="o">&gt;</span> <span class="n">page</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
   <span class="p">}</span>
   <span class="n">fl_writeImagePage</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="n">fl_endWriteImage</span><span class="p">();</span>

 <span class="n">fl_disconnect</span><span class="p">();</span>

 <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
 <span class="o">/*</span> <span class="n">main</span> <span class="n">application</span> <span class="o">-</span> <span class="n">calls</span> <span class="n">upgrade</span>
  <span class="o">*</span> <span class="n">to</span> <span class="n">perform</span> <span class="n">an</span> <span class="ow">in</span><span class="o">-</span><span class="n">field</span> <span class="n">upgrade</span> <span class="o">*/</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The call to <code class="docutils literal notranslate"><span class="pre">fl_connect</span></code> opens a connection between the xCORE and Quad SPI
flash device, and the call to <code class="docutils literal notranslate"><span class="pre">fl_getPageSize</span></code> determines the flash device’s
page size. All read and write operations occur at the page level.</p>
<p>The first upgrade image is located by calling <code class="docutils literal notranslate"><span class="pre">fl_getFactoryImage</span></code> and
then <code class="docutils literal notranslate"><span class="pre">fl_getNextBootImage</span></code>. Once located, <code class="docutils literal notranslate"><span class="pre">fl_startImageReplace</span></code>
prepares this image for replacement with a new image with the specified
(maximum) size.  If there is no upgrade image already installed to the
device, <code class="docutils literal notranslate"><span class="pre">fl_startImageAdd</span></code> prepares adding a new upgrade image, which
can be replaced by future upgrades using <code class="docutils literal notranslate"><span class="pre">fl_startImageReplace</span></code>.
<code class="docutils literal notranslate"><span class="pre">fl_startImageAdd</span></code> and <code class="docutils literal notranslate"><span class="pre">fl_startImageReplace</span></code> must be called until
they return 0, signifying that the preparation is complete.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">fl_writeImagePage</span></code> writes the next page of data to the
flash device. Calls to this function return after the data is output to
the device but may return before the device has written the data to its
flash memory. This increases the amount of time available to the
processor to fetch the next page of data. The function
<code class="docutils literal notranslate"><span class="pre">fl_endWriteImage</span></code> waits for the flash device to write the last page of
data to its flash memory. To simplify the writing operation, XFLASH adds
padding to the upgrade image to ensure that its size is a multiple of
the page size.</p>
<p>The call <code class="docutils literal notranslate"><span class="pre">fl_disconnect</span></code> closes the connection between the xCORE and
flash device.</p>
<p>Note each of the <code class="docutils literal notranslate"><span class="pre">fl...()</span></code> functions typically returns a code which should
be checked for success, prior to proceeding to the next step in the process of
writing an upgrade image. These checks have been left out of the example
above to aid clarity in following the process.</p>
</section>
<section id="build-and-deploy-the-upgrader">
<span id="design-with-flash-build-and-deploy-upgrader"></span><h3>Build and deploy the upgrader<a class="headerlink" href="#build-and-deploy-the-upgrader" title="Permalink to this heading">#</a></h3>
<p>To build and deploy the first release of your program,
<a class="reference internal" href="../../../installation/install-configure/getting-started.html#get-started-start-the-command-line-tools"><span class="std std-ref">start the tools</span></a>
and enter the following commands:</p>
<blockquote>
<div><ol class="arabic">
<li><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xcc<span class="w"> </span>main.xc<span class="w"> </span>target.xn<span class="w"> </span>-lquadflash<span class="w"> </span>-o<span class="w"> </span>first-release.xe
</pre></div>
</div>
<p>XCC compiles your program and links it against libquadflash.
Alternatively add the option -lflash to your Makefile.</p>
</li>
<li><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xflash<span class="w"> </span>first-release.xe<span class="w"> </span>-o<span class="w"> </span>manufacture-image
</pre></div>
</div>
<p>XFLASH generates an image in the xCORE flash format that contains a
first stage loader and the first release of your program as the
factory image.</p>
</li>
</ol>
</div></blockquote>
<p>To build and deploy an upgraded version of your program, enter the
following commands:</p>
<blockquote>
<div><ol class="arabic">
<li><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xcc<span class="w"> </span>main.xc<span class="w"> </span>target.xn<span class="w"> </span>-lquadflash<span class="w"> </span>-o<span class="w"> </span>latest-release.xe
</pre></div>
</div>
<p>XCC compiles your program and links it against libquadflash.</p>
</li>
<li><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xflash<span class="w"> </span>--upgrade<span class="w"> </span>&lt;version-id&gt;<span class="w"> </span>latest-release.xe<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--factory-version<span class="w"> </span>&lt;tools-version&gt;<span class="w"> </span>-o<span class="w"> </span>upgrade-image
</pre></div>
</div>
<p>XFLASH generates an upgrade image with the specified version number,
which must be greater than 0. Your program should obtain this image
to upgrade itself.</p>
</li>
</ol>
</div></blockquote>
<p>When the device is next reset, the loader boots the upgrade image, otherwise it boots
the factory image.</p>
</section>
<section id="write-a-program-that-upgrades-itself-using-spi-devices">
<h3>Write a program that upgrades itself using SPI devices<a class="headerlink" href="#write-a-program-that-upgrades-itself-using-spi-devices" title="Permalink to this heading">#</a></h3>
<p>The example above can be easily adjusted to use SPI devices with the libflash
library. Note the Quad SPI devices and SPI devices use different xcore ports
and pins so libquadflash cannot be used with a SPI device (in serial mode).</p>
<p>Changes required to use a SPI device are:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Include <code class="docutils literal notranslate"><span class="pre">flash.h</span></code> instead of <code class="docutils literal notranslate"><span class="pre">quadflash.h</span></code></p></li>
<li><p>Replace the <code class="docutils literal notranslate"><span class="pre">fl_QSPIPorts</span></code> structure with an instance of <code class="docutils literal notranslate"><span class="pre">fl_SPIPorts</span></code> that references the correct ports in the XN file.</p></li>
<li><p>Link against libflash by supplying <code class="docutils literal notranslate"><span class="pre">-lflash</span></code></p></li>
</ol>
</div></blockquote>
<p>The initial lines of the example above are shown below with the changes required:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;platform.h&gt;</span>
<span class="c1">#include &lt;flash.h&gt;</span>

<span class="c1">#define MAX_PSIZE 256</span>

<span class="o">/*</span> <span class="n">initializers</span> <span class="n">defined</span> <span class="ow">in</span> <span class="n">XN</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">available</span> <span class="n">via</span> <span class="n">platform</span><span class="o">.</span><span class="n">h</span> <span class="o">*/</span>

<span class="n">fl_SPIPorts</span> <span class="n">SPI</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">PORT_SPI_MISO</span><span class="p">,</span>
  <span class="n">PORT_SPI_SS</span><span class="p">,</span>
  <span class="n">PORT_SPI_CLK</span><span class="p">,</span>
  <span class="n">PORT_SPI_MOSI</span><span class="p">,</span>
  <span class="n">XS1_CLKBLK_1</span>
<span class="p">};</span>

<span class="nb">int</span> <span class="n">upgrade</span><span class="p">(</span><span class="n">chanend</span> <span class="n">c</span><span class="p">,</span> <span class="nb">int</span> <span class="n">usize</span><span class="p">)</span> <span class="p">{</span>

 <span class="o">/*</span> <span class="n">Obtain</span> <span class="n">an</span> <span class="n">upgrade</span> <span class="n">image</span> <span class="ow">and</span> <span class="n">write</span>
  <span class="o">*</span> <span class="n">it</span> <span class="n">to</span> <span class="n">flash</span> <span class="n">memory</span><span class="o">.</span>
  <span class="o">*</span> <span class="n">Error</span> <span class="n">checking</span> <span class="n">omitted</span> <span class="o">*/</span>

 <span class="n">fl_BootImageInfo</span> <span class="n">b</span><span class="p">;</span>
 <span class="n">unsigned</span> <span class="n">char</span> <span class="n">page</span><span class="p">[</span><span class="n">MAX_PSIZE</span><span class="p">];</span>
 <span class="nb">int</span> <span class="n">psize</span><span class="p">;</span>

 <span class="n">fl_connect</span><span class="p">(</span><span class="n">SPI</span><span class="p">);</span>

<span class="o">...</span>
</pre></div>
</div>
<p>Build for SPI, linking against libflash:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xcc<span class="w"> </span>main.xc<span class="w"> </span>target.xn<span class="w"> </span>-lflash<span class="w"> </span>-o<span class="w"> </span>first-release.xe
</pre></div>
</div>
</section>
</section>
<section id="customize-the-flash-loader">
<span id="id1"></span><h2>Customize the flash loader<a class="headerlink" href="#customize-the-flash-loader" title="Permalink to this heading">#</a></h2>
<p>The XTC tools let you customize the mechanism for choosing which image is
loaded from flash. The example program below determines which image to
load based on the value at the start of the data partition.</p>
<p>The XTC loader first calls the function <code class="docutils literal notranslate"><span class="pre">init</span></code>, and then iterates over each image
in the boot partition. For each image, it calls <code class="docutils literal notranslate"><span class="pre">checkCandidateImageVersion</span></code> with
the image version number and, if this function returns non-zero and its CRC
is validated, it calls <code class="docutils literal notranslate"><span class="pre">recordCandidateImage</span></code> with the image version number and
address. Finally, the loader calls <code class="docutils literal notranslate"><span class="pre">reportSelectedImage</span></code> to obtain the address of the
selected image.</p>
<p>To produce a custom loader, you are required to define the functions <code class="docutils literal notranslate"><span class="pre">init</span></code>,
<code class="docutils literal notranslate"><span class="pre">checkCandidateImageVersion</span></code>, <code class="docutils literal notranslate"><span class="pre">recordCandidateImage</span></code> and <code class="docutils literal notranslate"><span class="pre">reportSelectedImage</span></code>.
The loader provides the function <code class="docutils literal notranslate"><span class="pre">readFlashDataPage</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="n">void</span> <span class="o">*</span> <span class="n">readFlashDataPage</span><span class="p">(</span><span class="n">unsigned</span> <span class="n">addr</span><span class="p">);</span>
<span class="nb">int</span> <span class="n">dpVersion</span><span class="p">;</span>
<span class="n">void</span><span class="o">*</span> <span class="n">imgAdr</span><span class="p">;</span>

<span class="n">void</span> <span class="n">init</span> <span class="p">(</span><span class="n">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">void</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="n">readFlashDataPage</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">dpVersion</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="nb">int</span><span class="o">*</span><span class="p">)</span> <span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">int</span> <span class="n">checkCandidateImageVersion</span><span class="p">(</span><span class="nb">int</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">v</span> <span class="o">==</span> <span class="n">dpVersion</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">recordCandidateImage</span><span class="p">(</span><span class="nb">int</span> <span class="n">v</span><span class="p">,</span> <span class="n">unsigned</span> <span class="n">adr</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">imgAdr</span> <span class="o">=</span> <span class="n">adr</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">unsigned</span> <span class="n">reportSelectedImage</span><span class="p">(</span><span class="n">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">imgAdr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="build-the-loader-and-write-to-flash">
<span id="build-the-flash-loader"></span><h3>Build the loader and write to flash<a class="headerlink" href="#build-the-loader-and-write-to-flash" title="Permalink to this heading">#</a></h3>
<p>To create a flash image that contains a custom flash loader and factory image, start
the command-line tools and enter the following commands:</p>
<blockquote>
<div><ol class="arabic">
<li><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xcc<span class="w"> </span>-c<span class="w"> </span>loader.xc<span class="w"> </span>-o<span class="w"> </span>loader.o
</pre></div>
</div>
<p>XCC compiles your functions for image selection, producing a binary object.</p>
</li>
<li><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xflash<span class="w"> </span>a.xe<span class="w"> </span>--loader<span class="w"> </span>loader.o
</pre></div>
</div>
<p>XFLASH writes a flash image containing the custom loader and factory
image to the specified file.</p>
</li>
</ol>
</div></blockquote>
</section>
<section id="build-with-additional-images-and-create-a-binary-flash-file">
<span id="add-flash-images"></span><h3>Build with additional images and create a binary flash file<a class="headerlink" href="#build-with-additional-images-and-create-a-binary-flash-file" title="Permalink to this heading">#</a></h3>
<p>The following command builds a flash image that contains a custom flash loader, a
factory image and two additional images:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xflash<span class="w"> </span>factory.xe<span class="w"> </span>--loader<span class="w"> </span>loader.o<span class="w"> </span>--upgrade<span class="w"> </span><span class="m">1</span><span class="w"> </span>usb.xe<span class="w"> </span>0x20000<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--upgrade<span class="w"> </span><span class="m">2</span><span class="w"> </span>avb.xe<span class="w"> </span>-o<span class="w"> </span>image.bin
</pre></div>
</div>
<p>The arguments to <code class="docutils literal notranslate"><span class="pre">--upgrade</span></code> include the version number, executable file and an
optional size in bytes. XFLASH writes each upgrade image on the next sector
boundary. The size argument is used to add padding to an image, allowing it to be
field-upgraded in the future by a larger image.</p>
</section>
</section>
<section id="reading-the-numerical-and-string-identifiers-in-a-flash-image">
<span id="reading-identifiers"></span><h2>Reading the numerical and string identifiers in a flash image<a class="headerlink" href="#reading-the-numerical-and-string-identifiers-in-a-flash-image" title="Permalink to this heading">#</a></h2>
<p>A 32-bit integer identifier may be stored in the flash device as shown by the following xflash invocation example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xflash<span class="w"> </span>&lt;options&gt;<span class="w"> </span>--idnum<span class="w"> </span><span class="m">12345</span>
</pre></div>
</div>
<p>A string identifier may be stored in the flash device as shown by the following xflash invocation example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>xflash<span class="w"> </span>&lt;options&gt;<span class="w"> </span>--idstr<span class="w"> </span><span class="s2">&quot;My identifier string&quot;</span>
</pre></div>
</div>
<p>The following example application code shows how these identifiers may be read:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">get_ids</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">int</span> <span class="n">success</span><span class="p">;</span>
  <span class="n">success</span> <span class="o">=</span> <span class="n">fl_connectToDevice</span><span class="p">(</span><span class="n">ports</span><span class="p">,</span> <span class="n">deviceSpecs</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="o">//</span> <span class="n">Check</span> <span class="n">success</span>

  <span class="nb">int</span> <span class="n">identifier</span> <span class="o">=</span> <span class="n">fl_getFlashIdNum</span><span class="p">();</span>

  <span class="n">unsigned</span> <span class="n">char</span> <span class="n">idStr</span><span class="p">[</span><span class="n">MAX_LEN</span><span class="p">];</span>
  <span class="n">success</span> <span class="o">=</span> <span class="n">fl_getFlashIdStr</span><span class="p">(</span><span class="n">idStr</span><span class="p">,</span> <span class="n">MAX_LEN</span><span class="p">);</span>
  <span class="o">//</span> <span class="n">Check</span> <span class="n">success</span>

  <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../safeguard-ip/safeguard.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Safeguard IP and device authenticity</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../working-with-targets/intro.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Introduction</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, XMOS Ltd
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Jul 24, 2024</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Design and manufacture systems with flash memory</a><ul>
<li><a class="reference internal" href="#boot-a-program-from-flash-memory">Boot a program from flash memory</a></li>
<li><a class="reference internal" href="#generate-a-flash-image-for-manufacture">Generate a flash image for manufacture</a></li>
<li><a class="reference internal" href="#perform-an-in-field-upgrade">Perform an in-field upgrade</a><ul>
<li><a class="reference internal" href="#write-a-program-that-upgrades-itself-using-quad-spi-devices">Write a program that upgrades itself using Quad SPI devices</a></li>
<li><a class="reference internal" href="#build-and-deploy-the-upgrader">Build and deploy the upgrader</a></li>
<li><a class="reference internal" href="#write-a-program-that-upgrades-itself-using-spi-devices">Write a program that upgrades itself using SPI devices</a></li>
</ul>
</li>
<li><a class="reference internal" href="#customize-the-flash-loader">Customize the flash loader</a><ul>
<li><a class="reference internal" href="#build-the-loader-and-write-to-flash">Build the loader and write to flash</a></li>
<li><a class="reference internal" href="#build-with-additional-images-and-create-a-binary-flash-file">Build with additional images and create a binary flash file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reading-the-numerical-and-string-identifiers-in-a-flash-image">Reading the numerical and string identifiers in a flash image</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    </body>
</html>